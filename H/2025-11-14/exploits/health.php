<?php
header('Access-Control-Allow-Origin: *');
header('Content-Type: application/json');

$response = ['status' => 'ok', 'timestamp' => time(), 'server' => gethostname()];

if (isset($_GET['check'])) {
    $check_type = $_GET['check'];
    if ($check_type === 'metadata' && isset($_GET['url'])) {
        $url = $_GET['url'];
        $ctx = stream_context_create(['http' => ['timeout' => 5]]);
        $data = @file_get_contents($url, false, $ctx);
        if ($data !== false) {
            $response['metadata'] = $data;
        } else {
            $response['error'] = 'Failed to fetch metadata';
        }
    } else {
        $response['error'] = 'Unknown check type or missing url parameter';
    }
}

echo json_encode($response, JSON_PRETTY_PRINT);
?>
