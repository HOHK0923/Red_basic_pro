# 서버 빠른 복구 가이드

## 상황
- 공격 스크립트 실행 후 서버 외부 접속 안됨
- Apache는 실행 중 (systemctl status 확인)
- 팀원은 서버 내부 접속 가능

## 가장 가능성 높은 원인
**.htaccess 파일의 잘못된 Rewrite 규칙**

---

## 🚨 즉시 시도할 명령어 (팀원이 서버에서 실행)

### 1단계: .htaccess 제거 (가장 가능성 높은 해결책)
```bash
sudo rm -f /var/www/html/www/.htaccess
sudo rm -f /var/www/html/.htaccess
sudo systemctl restart httpd
```

### 2단계: 테스트
```bash
curl http://localhost/
```

### 3단계: 외부에서 테스트 (로컬 머신에서)
```bash
curl http://3.35.22.248/
```

---

## ✅ 만약 위 방법으로 해결되면

**원인**: 130_deface_all_pages.sh 스크립트가 만든 .htaccess의 RewriteRule이 문제

**해결됨**: .htaccess 제거로 정상화

---

## ❌ 만약 위 방법으로 해결 안되면

### Option A: 진단 스크립트 실행
```bash
sudo bash /tmp/134_quick_diagnosis.sh
```

### Option B: 전체 복구 스크립트 실행
```bash
sudo bash /tmp/133_fix_broken_server.sh
```

---

## 🔍 원인별 해결책

### 원인 1: .htaccess Rewrite 무한루프
- **증상**: localhost는 응답, 외부 접속시 타임아웃
- **해결**: .htaccess 삭제

### 원인 2: Apache 설정 오류
- **증상**: localhost도 응답 없음
- **해결**: httpd.conf 복구 또는 Apache 재설치

### 원인 3: AWS Security Group
- **증상**: localhost 정상, 외부만 타임아웃
- **해결**: AWS Console에서 포트 80 인바운드 규칙 확인

### 원인 4: 잘못된 Public IP
- **증상**: 다른 IP로 변경됨
- **확인**: `curl -s http://169.254.169.254/latest/meta-data/public-ipv4`

---

## 📝 팀원에게 전달할 메시지

```
서버에서 다음 명령어 실행해주세요:

sudo rm -f /var/www/html/www/.htaccess /var/www/html/.htaccess
sudo systemctl restart httpd
curl http://localhost/

그리고 결과 알려주세요!
```

---

## 복구 후 확인 사항

1. **웹 페이지 복구 확인**
   ```bash
   curl http://3.35.22.248/
   ```

2. **백업 파일 복구** (필요시)
   ```bash
   cd /var/www/html/www
   for f in *.backup; do sudo cp "$f" "${f%.backup}"; done
   ```

3. **악성 파일 제거 확인**
   ```bash
   sudo rm -f /var/www/html/www/system.php
   sudo rm -f /var/www/html/www/.system.php
   sudo rm -rf /var/www/html/www/downloads/
   ```

---

## 예방 조치

앞으로 공격 스크립트 실행 전:
1. 전체 백업 생성
2. 스냅샷 생성
3. 테스트 환경에서 먼저 실행
